(function(){return function(e){typeof exports=="object"?module.exports=module.exports=e.call(this,require):typeof define=="function"&&define.amd?define(["require","underscore","backbone","knockout","knockback"],e):this.kb=e.call(this,typeof require!="undefined"?require:undefined)}(function(e){var t,n,r,i,s;return n=this.kb||e("knockback"),i=n._,r=n.ko,s=r.utils.unwrapObservable,t=Array.prototype.slice,n.toFormattedString=function(e){var n,r,o,u,a,f;a=e.slice(),r=t.call(arguments,1);for(o in r){n=r[o],f=s(n);if(i.isUndefined(f)||i.isNull(f))f="";u=e.indexOf("{"+o+"}");while(u>=0)a=a.replace("{"+o+"}",f),u=e.indexOf("{"+o+"}",u+1)}return a},n.parseFormattedString=function(e,t){var n,r,s,o,u,a,f,l,c,h,p,d,v;h=t.slice(),s=0,a=0,l={};while(h.search("\\{"+s+"\\}")>=0){f=t.indexOf("{"+s+"}");while(f>=0)h=h.replace("{"+s+"}","(.*)"),l[f]=s,a++,f=t.indexOf("{"+s+"}",f+1);s++}n=s,c=new RegExp(h),u=c.exec(e),u&&u.shift();if(!u||u.length!==a){p=[];while(n-->0)p.push("");return p}v=i.sortBy(i.keys(l),function(e,t){return parseInt(e,10)}),r={};for(o in v){f=v[o],s=l[f];if(r.hasOwnProperty(s))continue;r[s]=o}d=[],s=0;while(s<n)d.push(u[r[s]]),s++;return d},n.FormattedObservable=function(){function e(e,o){var u,a;return i.isArray(o)?(e=e,a=o):a=t.call(arguments,1),u=n.utils.wrappedObservable(this,r.dependentObservable({read:function(){var t,r,i;o=[s(e)];for(r=0,i=a.length;r<i;r++)t=a[r],o.push(s(t));return n.toFormattedString.apply(null,o)},write:function(t){var r,i,o;i=n.parseFormattedString(t,s(e)),o=Math.min(a.length,i.length),r=0;while(r<o)a[r](i[r]),r++}})),u}return e.prototype.destroy=function(){return n.utils.wrappedDestroy(this)},e}(),n.formattedObservable=function(e,r){return new n.FormattedObservable(e,t.call(arguments,1))},n})}).call(this);