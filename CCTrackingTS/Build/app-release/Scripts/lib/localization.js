(function(){return function(e){typeof exports=="object"?module.exports=module.exports=e.call(this,require):typeof define=="function"&&define.amd?define(["require","underscore","backbone","knockout","knockback"],e):this.kb=e.call(this,typeof require!="undefined"?require:undefined)}(function(e){var t,n,r,i,s;return t=this.kb||e("knockback"),r=t._,n=t.ko,s=n.utils.unwrapObservable,t.locale_manager=void 0,i=t._publishMethods,t.LocalizedObservable=function(){function e(e,o,u){var a;return this.value=e,this.vm=u,o||(o={}),this.vm||(this.vm={}),this.read||_throwMissing(this,"read"),t.locale_manager||_throwMissing(this,"kb.locale_manager"),this.__kb||(this.__kb={}),this.__kb._onLocaleChange=r.bind(this._onLocaleChange,this),this.__kb._onChange=o.onChange,this.value&&(e=s(this.value)),this.vo=n.observable(e?this.read(e,null):null),a=t.utils.wrappedObservable(this,n.dependentObservable({read:function(e){return function(){return e.value&&s(e.value),e.vo(),e.read(s(e.value))}}(this),write:function(e){return function(t){e.write||_throwUnexpected(e,"writing to read-only"),e.write(t,s(e.value)),e.vo(t);if(e.__kb._onChange)return e.__kb._onChange(t)}}(this),owner:this.vm})),i(a,this,["destroy","observedValue","resetToCurrent"]),t.locale_manager.bind("change",this.__kb._onLocaleChange),o.hasOwnProperty("default")&&(a=t.DefaultObservable&&n.defaultObservable(a,o["default"])),a}return e.extend=t.extend,e.prototype.destroy=function(){return t.locale_manager.unbind("change",this.__kb._onLocaleChange),this.vm=null,t.utils.wrappedDestroy(this)},e.prototype.resetToCurrent=function(){var e,n;n=t.utils.wrappedObservable(this),e=this.value?this.read(s(this.value)):null;if(n()===e)return;return n(e)},e.prototype.observedValue=function(e){if(arguments.length===0)return this.value;this.value=e,this._onLocaleChange()},e.prototype._onLocaleChange=function(){var e;e=this.read(s(this.value)),this.vo(e);if(this.__kb._onChange)return this.__kb._onChange(e)},e}(),t.localizedObservable=function(e,n,r){return new t.LocalizedObservable(e,n,r)},t})}).call(this);