var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define(["require","exports","backbone"],function(e,t){(function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.default=function(){return{id:"",firstName:"",lastName:"",email:"",mobile:"",nic:"",userName:"",password:"",resetPassword:"",isAdmin:!1,authenticationToken:"",errorMessage:""}},t}(Backbone.Model);e.LoginDto=t})(t.Models||(t.Models={}));var n=t.Models}),__extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},define(["require","exports","CCTracking.WebClient/DAL/AjaxRequest","CCTracking.WebClient/Dtos/LoginDto"],function(e,t,n,r){function i(e){var t=new o;return t.doAjaxRequest(e,"POST","Login")}function s(e){var t=new o;return t.doAjaxRequest(e,"POST","ChangePassword")}var o=function(e){function t(){e.call(this,this)}return __extends(t,e),t.prototype.getResponse=function(){return new r.Models.LoginDto},t}(n.BaseDto);t.LoginDal=o,t.Login=i,t.ChangePasswrd=s}),__extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},define(["require","exports","../Helper","../App","marionette","jquery","knockout","text!./Login.html"],function(e,t,n,r){var i=e("underscore"),s=e("text!./Login.html"),o=function(e){function t(t,n){e.call(this,t,n)}return __extends(t,e),t}(n.ViewModel),u;t.LoginViewModel=o,u=function(e){function t(t){this.template=s,this.events={submit:"Login"},this.App=r.Application.getInstance(),e.call(this,t)}return __extends(t,e),t.prototype.Login=function(e){e.preventDefault(),this.trigger("LoginUser")},t}(n.Views.MvvmView),t.LoginView=u}),__extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},define(["require","exports","../App","../Helper","./LoginView","../Dtos/LoginDto","../DAL/Login","../Common/Views/HeaderView","../Dtos/AppObjectDto","../Bus/BusAvailabilityCtrl","../Home/HomeCtrl","marionette","jquery","knockout","text!./Login.html"],function(e,t,n,r,i,s,o,u,a,f,l){var c=e("underscore"),h=e("knockout"),p=e("knockback"),d=function(t){function c(){t.call(this),this.app=n.Application.getInstance(),this.backboneModel=new s.Models.LoginDto,this.loginViewModel=new i.LoginViewModel(this.backboneModel,this),this.loginView=new i.LoginView({viewModel:this.loginViewModel})}return __extends(c,t),c.prototype.Load=function(){var e=this;this.loginView=new i.LoginView,this.app.LoginRegion.show(this.loginView),this.loginView.on("LoginUser",function(){return e.Login(e.loginViewModel.bbModel)})},c.prototype.Login=function(e){var t=this,n=this.app.request("AppGlobalSetting"),r;e.set("userName",$("#txtUserName").val()),e.set("password",$("#txtPassword").val()),r=o.Login(e),r.done(function(e){return t.Authenticated(e)})},c.prototype.Authenticated=function(t){var n=$("#lblLoginMessage"),i,s;if(t==undefined){r.ShowModalPopup("danger","Authentication","User name or password is wrong..!<br> Pelase try again");return}if(t.errorMessage!==null)r.ShowModalPopup("danger","Authentication",t.errorMessage);else{i=new a.Models.AppObject,i.set("Id",t.id),i.set("FirstName",t.firstName),i.set("LastName",t.lastName),i.set("UserName",t.userName),i.set("IsAdmin",t.isAdmin),i.set("AuthenticationToken",t.authenticationToken),this.app.reqres.setHandler("AppGlobalSetting",function(){return i},this),this.app.LoginRegion.close();var o=this.app.request("AppGlobalSetting"),c=new Backbone.Model({firstName:o.get("FirstName"),lastName:o.get("LastName"),userName:o.get("UserName")}),h=new u.HeaderItemView({model:c});this.app.HeaderRegion.show(h),(new f.BusAvailabilityCtrl).Show(),o.get("IsAdmin")?(s=new l.HomeCtrl,s.Show(),this.app.applyRouting(this.app,this.app.AppLayout)):(e(["../Booking/BookingCtrl"],function(e){(new e.BookingCtrl).GetAll(1)}),this.app.applyRoutingForOperator(this.app,this.app.AppLayout))}},c.prototype.Cancel=function(){window.location.href="#viewLogin"},c}(r.Controller);t.LoginCtrl=d});