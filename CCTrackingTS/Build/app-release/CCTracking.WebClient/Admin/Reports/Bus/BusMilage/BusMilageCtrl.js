var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define(["require","exports","../../../../App","../../../../Helper","./BusMilageView","../../../../Dtos/BookingSummaryDto","../../../../DAL/BusMilage","marionette","jquery","knockout"],function(e,t,n,r,i,s,o){var u=e("underscore"),a=e("knockout"),f=e("knockback"),l=function(e){function t(){e.call(this),this.app=n.Application.getInstance(),this.backboneModel=new s.Models.BookingSummaryDto,this.searchViewModel=new i.BusMilageViewModel(this.backboneModel,this),this.compositeModel=new Backbone.Model,this.backboneCollection=new Backbone.Collection([]),this.collectionView=new i.BusMilageCollectionView({collection:this.backboneCollection,model:this.compositeModel}),this.backboneCollection.reset([])}return __extends(t,e),t.prototype.Show=function(){var e=this,t,n=JSON.parse(localStorage.getItem("lookupResponse")),i=this.backboneModel,o=this.app.request("ReportFilterSetting");i.set("busList",n.bus);if(o!=undefined){i.set("fromBookingDate",o.get("fromDate")),i.set("toBookingDate",o.get("toDate"));var l=u.filter(n.bus,function(e){return e.id==o.get("busId")});i.set("busSelected",l[0]),t=new s.Models.BookingSummaryDto,t.set("busSelected",l[0]),t.set("fromBookingDate",o.get("fromDate")),t.set("toBookingDate",o.get("toDate"))}else i.set("fromBookingDate",r.FormatDateString(Date.now())),i.set("toBookingDate",r.FormatDateString(Date.now())),i.set("busSelected","");this.compositeModel=i,this.collectionView.model=this.compositeModel,this.collectionView.listenTo(this.collectionView,"BusMilage",function(){return e.BusMilage(i)}),this.collectionView.on("Event:PrintReport",function(){r.PrintReport(e.backboneCollection,e.GetHeaderList(),"Bus Milage Report","BusVisit")}),this.app.MainRegion.show(this.collectionView);var c=this.collectionView.$el,h=f.viewModel(this.compositeModel),p=c.find("#txtFromBookingDate")[0];a.cleanNode(p),a.applyBindings(h,p);var d=c.find("#txtToBookingDate")[0];a.cleanNode(d),a.applyBindings(h,d);var v=c.find("#ddlBusDetails")[0];a.cleanNode(v),a.applyBindings(h,v),t!=undefined&&this.BusMilage(t)},t.prototype.GetHeaderList=function(){var e=new Backbone.Collection([{columnHeader:"Bus No"},{columnHeader:"Visit Date"},{columnHeader:"Visit Type"},{columnHeader:"Amount"},{columnHeader:"Mileage"},{columnHeader:"Out Time"},{columnHeader:"In Time"},{columnHeader:"Time Taken"},{columnHeader:"Driver"},{columnHeader:"Booking Centre"}]);return e},t.prototype.BusMilage=function(e){var t=this;e.get("busSelected")!=undefined&&e.get("busSelected").id!=undefined?e.set("busId",e.get("busSelected").id):e.get("busSelected")!=undefined&&e.set("busId",e.get("busSelected")),this.app.request("ReportFilterSetting","");var n=o.GetByCriteria(this.GetMinimalRequest(e));n.done(function(e){return t.GetByCriteriaCompleted(e)})},t.prototype.GetMinimalRequest=function(e){var t=new s.Models.BookingSummaryDto;return t.set("fromBookingDate",e.get("fromBookingDate")),t.set("toBookingDate",e.get("toBookingDate")),t.set("busSelected",e.get("busSelected")),t.set("busId",e.get("busId")),t},t.prototype.GetByCriteriaCompleted=function(e){var t=e.bookingSummaryList,n=[];for(var i=0;i<t.length;i++)n[i]={alkhidmatCentre:t[i].alkhidmatCentre,alkhidmatCentreId:t[i].alkhidmatCentreId,bookingAmount:t[i].bookingAmount,bookingMilage:t[i].bookingMilage,busNo:t[i].busNo,busId:t[i].busId,visitType:t[i].visitType,visitDate:r.FormatDateString(t[i].visitDate),outTime:t[i].outTime,inTime:t[i].inTime,timeTaken:t[i].timeTaken,driver:t[i].driver};this.backboneCollection.reset(n)},t.prototype.Cancel=function(){window.location.href="#busMilageReport"},t.prototype.UIBinding=function(e){var t=JSON.parse(localStorage.getItem("lookupResponse"));e.set("landmarkList",t.landmark);var n=u.filter(t.landmark,function(t){return t.id==e.get("landmarkId")});e.set("landmarkIdSelected",n[0])},t}(r.Controller);t.BusMilageCtrl=l});