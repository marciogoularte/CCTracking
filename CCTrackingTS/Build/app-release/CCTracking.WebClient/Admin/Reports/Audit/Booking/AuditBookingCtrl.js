var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define(["require","exports","../../../../App","../../../../Helper","./AuditBookingView","../../../../Dtos/BookingDto","../../../../DAL/Booking","marionette","jquery","knockout"],function(e,t,n,r,i,s,o){var u=e("underscore"),a=e("knockout"),f=e("knockback"),l=function(e){function t(){e.call(this),this.app=n.Application.getInstance(),this.backboneModel=new s.Models.AuditBooking,this.compositeModel=new Backbone.Model,this.backboneCollection=new Backbone.Collection([]),this.collectionView=new i.AuditBookingCollectionView({collection:this.backboneCollection}),this.backboneCollection.reset([])}return __extends(t,e),t.prototype.Show=function(){var e=this,t=this.backboneModel;t.set("fromDate",r.FormatDateString(Date.now())),t.set("toDate",r.FormatDateString(Date.now())),this.compositeModel=t,this.collectionView.model=t,this.app.MainRegion.show(this.collectionView),this.collectionView.listenTo(this.collectionView,"Event:AuditBooking",function(t){return e.GetAuditBookingDetial(t)});var n=f.viewModel(this.compositeModel),i=$("#txtFromDate")[0];a.cleanNode(i),a.applyBindings(n,i);var s=$("#txtToDate")[0];a.cleanNode(s),a.applyBindings(n,s)},t.prototype.GetAuditBookingDetial=function(e){var t=this,n=new Backbone.Model(e);if(n.get("fromDate")==""||n.get("toDate")==""){r.ShowModalPopup("danger","Audit Booking","Please enter valid search criteria");return}var i=o.GetAllAuditBooking(n);i.done(function(e){return t.AuditBookingCompleted(e)})},t.prototype.AuditBookingCompleted=function(e){var t=e.auditBookingDisplayList,n=[];for(var i=0;i<t.length;i++)n[i]={bookingId:t[i].bookingId,userName:t[i].userName,propertyName:t[i].propertyName,oldValue:t[i].oldValue,newValue:t[i].newValue,actualModifiedDate:r.FormatDateString(t[i].actualModifiedDate),rowCounter:t[i].rowCounter};this.backboneCollection.reset(n)},t}(r.Controller);t.AuditBookingCtrl=l});