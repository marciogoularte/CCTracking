var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define(["require","exports","../../../../App","../../../../Helper","./BusCentreReportView","../../../../Dtos/BookingSummaryDto","../../../../Dtos/ReportDto","../../../../DAL/BusCentreReport","marionette","jquery","knockout"],function(e,t,n,r,i,s,o,u){var a=e("underscore"),f=e("knockout"),l=e("knockback"),c,h=function(e){function t(){e.call(this),this.app=n.Application.getInstance(),this.backboneModel=new s.Models.BookingSummaryDto,this.searchViewModel=new i.SearchViewModel(this.backboneModel,this),this.compositeModel=new Backbone.Model,this.backboneCollection=new Backbone.Collection([]),this.collectionView=new i.SearchCollectionView({collection:this.backboneCollection,model:this.compositeModel}),this.backboneCollection.reset([])}return __extends(t,e),t.prototype.Show=function(){this.Load()},t.prototype.Load=function(){var e=this,t=this.backboneModel,n=this.app.request("ReportFilterSetting");t.set("fromBookingDate",n.get("fromDate")),t.set("toBookingDate",n.get("toDate")),t.set("centreId",n.get("centreId")),this.compositeModel=t,this.collectionView.listenTo(this.collectionView,"BusCentreReport",function(){return e.GetByCriteria(e.searchViewModel.bbModel)}),this.collectionView.listenTo(this.collectionView,"Event:PrintReport",function(t){r.PrintReport(e.backboneCollection,e.GetHeaderList(),"Centre Specific Bus Details","Mileage")}),this.collectionView.listenTo(this.collectionView,"itemview:BusVisitDetails",function(n,r){e.ShowBusVisitDetails(r,t)}),this.collectionView.on("CancelForm",function(){return e.Cancel()}),this.app.MainRegion.show(this.collectionView);var i=l.viewModel(this.compositeModel),o=$("#txtFromBookingDate")[0];f.cleanNode(o),f.applyBindings(i,o);var a=$("#txtToBookingDate")[0];f.cleanNode(a),f.applyBindings(i,a);var c=new s.Models.BookingSummaryDto;c.set("centreId",n.get("centreId")),c.set("fromBookingDate",n.get("fromDate")),c.set("toBookingDate",n.get("toDate"));var h=u.GetByCriteria(c);h.done(function(t){return e.GetByCriteriaCompleted(t)})},t.prototype.GetHeaderList=function(){var e=new Backbone.Collection([{columnHeader:"Centre Name"},{columnHeader:"Bus No"},{columnHeader:"Booking Amount"},{columnHeader:"Booking Milage"},{columnHeader:"Bookings"},{columnHeader:"Receivables"}]);return e},t.prototype.ShowBusVisitDetails=function(e,t){var n=new o.Models.ReportDto;n.set("fromDate",t.get("fromBookingDate")),n.set("toDate",t.get("toBookingDate")),n.set("busId",e),this.app.reqres.setHandler("ReportFilterSetting",function(){return n},this),location.href="#busMilageReport"},t.prototype.GetByCriteria=function(e){var t=this;e.get("fromBookingDate").trim()!=""&&e.set("fromBookingDate",r.FormatDateString(e.get("fromBookingDate"))),e.get("toBookingDate").trim()!=""&&e.set("toBookingDate",r.FormatDateString(e.get("toBookingDate")));var n=u.GetByCriteria(this.GetMinimalRequest(e));n.done(function(e){return t.GetByCriteriaCompleted(e)})},t.prototype.GetMinimalRequest=function(e){var t=new s.Models.BookingSummaryDto;return t.set("centreId",e.get("centreId")),t.set("fromBookingDate",e.get("fromBookingDate")),t.set("toBookingDate",e.get("toBookingDate")),t},t.prototype.GetByCriteriaCompleted=function(e){var t=e.bookingSummaryList,n=[];for(var r=0;r<t.length;r++)n[r]={alkhidmatCentre:t[r].alkhidmatCentre,alkhidmatCentreId:t[r].alkhidmatCentreId,bookingAmount:t[r].bookingAmount,bookingMilage:t[r].bookingMilage,bookings:t[r].bookings,receivables:t[r].receivables,busNo:t[r].busNo,busId:t[r].busId};this.backboneCollection.reset(n)},t.prototype.Cancel=function(){window.location.href="#busCentreReport"},t}(r.Controller);t.BusCentreReportCtrl=h});