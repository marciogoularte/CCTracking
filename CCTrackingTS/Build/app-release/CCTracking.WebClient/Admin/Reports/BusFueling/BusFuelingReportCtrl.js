var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define(["require","exports","../../../App","../../../Helper","./BusFuelingReportView","../../../Dtos/BookingSummaryDto","../../../Dtos/ReportDto","../../../DAL/BusFuelingReport","marionette","jquery","knockout"],function(e,t,n,r,i,s,o,u){var a=e("underscore"),f=e("knockout"),l=e("knockback"),c,h=function(e){function t(){e.call(this),this.app=n.Application.getInstance(),this.backboneModel=new s.Models.BookingSummaryDto,this.searchViewModel=new i.SearchViewModel(this.backboneModel,this),this.compositeModel=new Backbone.Model,this.backboneCollection=new Backbone.Collection([]),this.collectionView=new i.SearchCollectionView({collection:this.backboneCollection,model:this.compositeModel}),this.backboneCollection.reset([])}return __extends(t,e),t.prototype.Show=function(){this.Load()},t.prototype.Load=function(){var e=this,t=JSON.parse(localStorage.getItem("lookupResponse")),n=this.backboneModel;n.set("fromBookingDate",r.FormatDateString(Date.now())),n.set("toBookingDate",r.FormatDateString(Date.now())),n.set("busList",t.bus),n.set("busSelected",""),this.compositeModel=n,this.collectionView.listenTo(this.collectionView,"BusFuelingReport",function(){return e.GetByCriteria(e.searchViewModel.bbModel)}),this.collectionView.listenTo(this.collectionView,"itemview:BusVisitDetails",function(t,r){e.ShowBusVisitDetails(r,n)}),this.collectionView.on("CancelForm",function(){return e.Cancel()}),this.app.MainRegion.show(this.collectionView);var i=this.collectionView.$el,s=l.viewModel(this.compositeModel),o=i.find("#txtFromBookingDate")[0];f.cleanNode(o),f.applyBindings(s,o);var u=i.find("#txtToBookingDate")[0];f.cleanNode(u),f.applyBindings(s,u);var a=i.find("#ddlBusDetails")[0];f.cleanNode(a),f.applyBindings(s,a)},t.prototype.ShowBusVisitDetails=function(e,t){var n=new o.Models.ReportDto;n.set("fromDate",t.get("fromBookingDate")),n.set("toDate",t.get("toBookingDate")),n.set("busId",e),this.app.reqres.setHandler("ReportFilterSetting",function(){return n},this),location.href="#busMilageReport"},t.prototype.GetByCriteria=function(e){var t=this;e.get("fromBookingDate").trim()!=""&&e.set("fromBookingDate",r.FormatDateString(e.get("fromBookingDate"))),e.get("toBookingDate").trim()!=""&&e.set("toBookingDate",r.FormatDateString(e.get("toBookingDate"))),e.get("busSelected")!=undefined&&e.set("busId",e.get("busSelected").id);var n=u.GetByCriteria(e);n.done(function(e){return t.GetByCriteriaCompleted(e)})},t.prototype.GetByCriteriaCompleted=function(e){var t=e.bookingSummaryList,n=[];for(var i=0;i<t.length;i++)n[i]={alkhidmatCentre:t[i].alkhidmatCentre,bookingAmount:r.FormatMoney(t[i].bookingAmount),bookingMilage:r.FormatMoney(t[i].bookingMilage),busNo:t[i].busNo,busId:t[i].busId,currentReading:r.FormatMoney(t[i].currentReading),previusReading:r.FormatMoney(t[i].previusReading),fuelQuantity:r.FormatMoney(t[i].fuelQuantity),fuelRate:r.FormatMoney(t[i].fuelRate),averageMilage:r.FormatMoney(t[i].averageMilage),pumpLocation:t[i].pumpLocation,visitType:t[i].visitType,visitDate:r.FormatDateString(t[i].visitDate),outTime:t[i].outTime,inTime:t[i].inTime,timeTaken:t[i].timeTaken,driver:t[i].driver,fuelingReceipt:t[i].fuelingReceipt};this.backboneCollection.reset(n)},t.prototype.Cancel=function(){window.location.href="#busCentreReport"},t}(r.Controller);t.BusFuelingReportCtrl=h});