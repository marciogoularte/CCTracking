var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define(["require","exports","../../App","../../Helper","./AdminSearchBookingView","../../Dtos/BookingSummaryDto","../../Dtos/ReportDto","../../DAL/AdminSearch","marionette","jquery","knockout"],function(e,t,n,r,i,s,o,u){var a=e("underscore"),f=e("knockout"),l=e("knockback"),c,h=function(e){function t(){e.call(this),this.app=n.Application.getInstance(),this.backboneModel=new s.Models.BookingSummaryDto,this.searchViewModel=new i.SearchViewModel(this.backboneModel,this),this.compositeModel=new Backbone.Model,this.backboneCollection=new Backbone.Collection([]),this.collectionView=new i.SearchCollectionView({collection:this.backboneCollection,model:this.compositeModel}),this.backboneCollection.reset([])}return __extends(t,e),t.prototype.Show=function(){this.Load()},t.prototype.Load=function(){var e=this,t=this.backboneModel;t.set("fromBookingDate",r.FormatDateString(Date.now())),t.set("toBookingDate",r.FormatDateString(Date.now())),this.compositeModel=t,this.collectionView.listenTo(this.collectionView,"AdminSearchBooking",function(){return e.GetByCriteria(e.searchViewModel.bbModel)}),this.collectionView.listenTo(this.collectionView,"Event:PrintReport",function(t){r.PrintReport(e.backboneCollection,e.GetHeaderList(),"Centre Specific Summary Report","Booking")}),this.collectionView.listenTo(this.collectionView,"itemview:CentreBusSummary",function(n,r){e.ShowCentreBusSummary(r,t)}),this.collectionView.on("CancelForm",function(){return e.Cancel()}),this.app.MainRegion.show(this.collectionView);var n=l.viewModel(this.compositeModel),i=$("#txtFromBookingDate")[0];f.cleanNode(i),f.applyBindings(n,i);var s=$("#txtToBookingDate")[0];f.cleanNode(s),f.applyBindings(n,s)},t.prototype.GetHeaderList=function(){var e=new Backbone.Collection([{columnHeader:"Centre Name"},{columnHeader:"Booking Amount"},{columnHeader:"Booking Mileage"},{columnHeader:"Bookings"},{columnHeader:"Receivables"}]);return e},t.prototype.ShowCentreBusSummary=function(e,t){var n=new o.Models.ReportDto;n.set("fromDate",t.get("fromBookingDate")),n.set("toDate",t.get("toBookingDate")),n.set("centreId",e),this.app.reqres.setHandler("ReportFilterSetting",function(){return n},this),location.href="#busCentreReport"},t.prototype.GetByCriteria=function(e){var t=this;e.get("fromBookingDate").trim()!=""&&e.set("fromBookingDate",r.FormatDateString(e.get("fromBookingDate"))),e.get("toBookingDate").trim()!=""&&e.set("toBookingDate",r.FormatDateString(e.get("toBookingDate")));var n=u.GetByCriteria(e);n.done(function(e){return t.GetByCriteriaCompleted(e)})},t.prototype.GetByCriteriaCompleted=function(e){var t=e.bookingSummaryList,n=[];for(var i=0;i<t.length;i++)n[i]={alkhidmatCentre:t[i].alkhidmatCentre,alkhidmatCentreId:t[i].alkhidmatCentreId,bookingAmount:r.FormatMoney(t[i].bookingAmount),bookingMilage:t[i].bookingMilage,bookings:t[i].bookings,receivables:r.FormatMoney(t[i].receivables)};this.backboneCollection.reset(n)},t.prototype.Cancel=function(){window.location.href="#adminSearchBooking"},t}(r.Controller);t.AdminSearchBookingCtrl=h});