var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define(["require","exports","../App","../Helper","./HomeView","../Dtos/HomeDto","../DAL/Home","../DAL/AdminSearch","marionette","jquery","knockout"],function(e,t,n,r,i,s,o,u){var a=e("underscore"),f=e("knockout"),l=function(e){function t(){e.call(this),this.app=n.Application.getInstance(),this.homeItemView=new i.HomeItemView}return __extends(t,e),t.prototype.Show=function(){var e=this;this.app.MainRegion.show(this.homeItemView);var t=new s.Models.HomeDto,n=new Date,i=new Date(n.setDate(n.getDate()-r.GetNoOfDaysConfiguration()));t.set("fromDate",r.FormatDateString(i)),t.set("toDate",r.FormatDateString(new Date));var u=o.GetByCriteria(t);u.done(function(t){e.ShowChart(t)}),this.ShowCentreSummaryReport()},t.prototype.ShowCentreSummaryReport=function(){var e=new Backbone.Model,t=new Date,n=new Date(t.setDate(t.getDate()-r.GetNoOfDaysConfiguration()));e.set("fromBookingDate",r.FormatDateString(n)),e.set("toBookingDate",r.FormatDateString(new Date)),this.GetByCriteria(e)},t.prototype.GetByCriteria=function(e){var t=this;e.get("fromBookingDate").trim()!=""&&e.set("fromBookingDate",r.FormatDateString(e.get("fromBookingDate"))),e.get("toBookingDate").trim()!=""&&e.set("toBookingDate",r.FormatDateString(e.get("toBookingDate")));var n=u.GetByCriteria(e);n.done(function(e){return t.GetByCriteriaCompleted(e)})},t.prototype.GetByCriteriaCompleted=function(e){var t=this,n=e.bookingSummaryList,s=[],o=0,u=0,a=0,f=0,l=0;for(var c=0;c<n.length;c++)s[c]={alkhidmatCentre:n[c].alkhidmatCentre,alkhidmatCentreId:n[c].alkhidmatCentreId,bookingAmount:r.FormatMoney(n[c].bookingAmount),maintenance:r.FormatMoney(n[c].maintenance),bookingMilage:r.FormatMoney(n[c].bookingMilage),bookings:n[c].bookings,receivables:r.FormatMoney(n[c].receivables)},o+=parseFloat(n[c].bookingAmount),l+=parseFloat(n[c].maintenance),u+=parseFloat(n[c].bookingMilage),a+=parseInt(n[c].bookings),f+=parseFloat(n[c].receivables);var h=new Backbone.Model({totalBookingAmount:r.FormatMoney(o),totalBookingMilage:r.FormatMoney(u),totalMaintenance:r.FormatMoney(l),totalBookings:a,totalReceivables:r.FormatMoney(f)});this.collectionView=new i.SearchCollectionView({collection:new Backbone.Collection(s),model:h}),this.collectionView.on("Event:PrintReport",function(e){r.PrintReport(new Backbone.Collection(s),t.GetHeaderList(),"Centre Specific Summary Report","Dashboard")}),this.app.SubRegion.reset(),this.app.SubRegion.show(this.collectionView)},t.prototype.GetHeaderList=function(){var e=new Backbone.Collection([{columnHeader:"Centre Name"},{columnHeader:"Booking Amount"},{columnHeader:"Maintenance"},{columnHeader:"Booking Milage"},{columnHeader:"Bookings"},{columnHeader:"Receivables"}]);return e},t.prototype.ShowChart=function(e){var t=[],n=[],r=[],i=[],s=[];a.map(e.homeList,function(e){return t.push(e.centreDesc),n.push(e.bookingAmount),r.push(e.maintenance),i.push(e.receivable),s.push(e.profit),e}),this.homeItemView.$el.find("#container").highcharts({chart:{type:"column",backgroundColor:"transparent",options3d:{enabled:!0,alpha:15,beta:15,viewDistance:25,depth:40},marginTop:80,marginRight:40},title:{text:"Booking Summary Report - Centre Wise",style:{color:"grey"}},xAxis:{categories:t},legend:{itemStyle:{color:"grey"}},yAxis:{allowDecimals:!1,min:0,title:{text:"Amount in Rs"}},tooltip:{headerFormat:"<b>{point.key}</b><br>",pointFormat:'<span style="color:{series.color}">‚óè</span> {series.name}: {point.y}'},plotOptions:{column:{stacking:"normal",depth:40}},series:[{name:"Booking",data:n,stack:"Booking"},{name:"Maintenance",data:r,stack:"Maintenance"},{name:"Receivable",data:i,stack:"Receivable"},{name:"Profit",data:s,stack:"Profit"}]});var o=this.homeItemView.$el.find("text")[this.homeItemView.$el.find("text").length-1];o!=undefined&&(o.innerHTML="")},t}(r.Controller);t.HomeCtrl=l});