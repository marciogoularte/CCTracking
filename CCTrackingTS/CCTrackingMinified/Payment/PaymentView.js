var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);i.prototype=t.prototype,e.prototype=new i};define(["require","exports","../Helper","../App","marionette","jquery","knockout","text!./PaymentTmpl.html","text!./PaymentGrid.html"],function(e,t,i,a){var s,o=e("underscore"),r=e("knockout"),n=e("text!./PaymentTmpl.html"),l=e("text!./PaymentGrid.html"),d=function(e){function t(t,i){var a=this;e.call(this,t,i),this.model.paymentTypeSelected.subscribe(function(){a.model.isCash=1==a.model.paymentTypeSelected().id?!0:!1})}return __extends(t,e),t}(i.ViewModel);t.PaymentViewModel=d;var h=function(e){function t(t,i){s=a.Application.getInstance(),this.template=n,this.viewModel=new b(t,i),this.bbModel=new Backbone.Model,this.events={submit:"Save","click .jsCancel":"Cancel","click .jsAddMore":"AddMore","click .jsUpdateMore":"UpdateMore"},e.call(this,i)}return __extends(t,e),t.prototype.Cancel=function(){window.location.href="#viewBooking"},t.prototype.AddMore=function(){this.trigger("BusVisitAddItem",this.viewModel.bookingId(),this.viewModel.alkhidmatCentreSelected(),this.viewModel.driverSelected(),this.viewModel.busSelected(),this.viewModel.fuelAmount())},t.prototype.UpdateMore=function(){this.trigger("BusVisitUpdateItem",this.viewModel.bookingId(),this.viewModel.alkhidmatCentreSelected(),this.viewModel.driverSelected(),this.viewModel.busSelected(),this.viewModel.fuelAmount(),this.viewModel.busChangeReason())},t.prototype.Save=function(e){e.preventDefault(),this.bbModel.set("id",this.viewModel.Id()),this.bbModel.set("bookingId",this.viewModel.bookingId()),this.bbModel.set("paymentType",this.viewModel.paymentType()),this.bbModel.set("pricing",this.viewModel.pricing()),this.bbModel.set("amount",this.viewModel.amount()),this.bbModel.set("paymentLocation",this.viewModel.paymentLocation()),this.bbModel.set("officerId",this.viewModel.officerId()),this.bbModel.set("receiptNo",this.viewModel.receiptNo()),this.bbModel.set("extraAmountCharge",this.viewModel.extraAmountCharge()),this.bbModel.set("extraAmountReason",this.viewModel.extraAmountReason()),this.bbModel.set("extraAmountReceipt",this.viewModel.extraAmountReceipt()),this.bbModel.set("isReferralBooking","1"==this.viewModel.isReferralBooking()?!0:!1),this.bbModel.set("isReferralBookingPaid","1"==this.viewModel.isReferralBookingPaid()?!0:!1),this.bbModel.set("referralPaymentDate",this.viewModel.referralPaymentDate()),this.bbModel.set("easyPaisaTranNo",this.viewModel.easyPaisaTranNo()),this.bbModel.set("paymentLocation",this.viewModel.paymentLocationSelected().id),this.bbModel.set("officerId",this.viewModel.cashierSelected().id),this.bbModel.set("paymentType",this.viewModel.paymentTypeSelected().id),this.bbModel.set("fuelAmount",this.viewModel.fuelAmount()),this.bbModel.set("busChangeReason",this.viewModel.busChangeReason()),this.trigger("PaymentSave",this.bbModel)},t.prototype.onShow=function(){r.applyBindings(this.viewModel,this.el),this.$el.find("#lnkUpdate").hide()},t.prototype.onClose=function(){s.vent.off("Event:UpdateSummary")},t}(i.Views.ItemView);t.PaymentView=h;var b=function(){function e(e,t){var a=this;if(void 0==t){this.Id=r.observable(),this.bookingId=r.observable(),this.paymentType=r.observable(),this.pricing=r.observable(),this.amount=r.observable(),this.paymentLocation=r.observable(),this.officerId=r.observable(),this.receiptNo=r.observable(),this.extraAmountCharge=r.observable(),this.extraAmountReason=r.observable(),this.extraAmountReceipt=r.observable(),this.isReferralBooking=r.observable(),this.isReferralBookingPaid=r.observable(),this.referralPaymentDate=r.observable(),this.paymentStatus=r.observable(),this.isReferral=r.computed({owner:this,read:function(){return 1==a.isReferralBooking()&&1!=a.paymentStatus()?!0:!1}}),this.easyPaisaTranNo=r.observable();var s=JSON.parse(localStorage.getItem("lookupResponse"));this.busList=r.observableArray(e),this.fuelAmount=r.observable(),this.busChangeReason=r.observable(),this.busSelected=r.observable(),this.driverList=r.observableArray(s.driver),this.driverSelected=r.observable(),this.alkhidmatCentreList=r.observableArray(s.alkhidmatCentre),this.alkhidmatCentreSelected=r.observable(),this.paymentLocationList=r.observableArray(s.alkhidmatCentre),this.paymentLocationSelected=r.observable(),this.cashierList=r.observableArray(s.cashier),this.cashierSelected=r.observable(),this.paymentTypeList=r.observableArray(s.paymentType),this.paymentTypeSelected=r.observable(),this.currentDisplay=r.observable(),this.isEasyPaisa=r.computed({owner:this,read:function(){return void 0!=a.paymentTypeSelected()&&2===a.paymentTypeSelected().id&&""==a.easyPaisaTranNo().trim()?!0:!1}}),this.isPaid=r.computed({owner:this,read:function(){return"1"==a.paymentStatus()?!0:!1}}),this.isCancel=r.computed({owner:this,read:function(){return"2"==a.paymentStatus()?!0:!1}}),this.paymentStatusDesc=r.computed({owner:this,read:function(){return"1"==a.paymentStatus()?(a.currentDisplay("panel panel-default"),"Paid"):"2"==a.paymentStatus()?(a.currentDisplay("panel panel-danger"),"Cancel"):(a.currentDisplay("panel panel-warning"),"Unpaid")}})}else{this.Id=r.observable(t.get("id")),this.bookingId=r.observable(t.get("bookingId")),this.paymentType=r.observable(),this.pricing=r.observable(),this.amount=r.observable(i.FormatMoney(t.get("amount"))),this.paymentLocation=r.observable(),this.officerId=r.observable(),this.receiptNo=r.observable(t.get("receiptNo")),this.extraAmountCharge=r.observable(t.get("extraAmountCharge")),this.extraAmountReason=r.observable(t.get("extraAmountReason")),this.extraAmountReceipt=r.observable(t.get("extraAmountReceipt")),this.isReferralBooking=r.observable(t.get("isReferralBooking")?"1":"0"),this.isReferralBookingPaid=r.observable(t.get("isReferralBookingPaid")?"1":"0"),this.referralPaymentDate=r.observable("0001-01-01T00:00:00"!=t.get("referralPaymentDate")?i.FormatDateString(t.get("referralPaymentDate")):""),this.paymentStatus=r.observable(t.get("paymentStatus")),this.isReferral=r.computed({owner:this,read:function(){return 1==a.isReferralBooking()&&1!=a.paymentStatus()?!0:!1}}),this.easyPaisaTranNo=r.observable(t.get("easyPaisaTranNo"));var s=JSON.parse(localStorage.getItem("lookupResponse"));this.busList=r.observableArray(e),this.fuelAmount=r.observable(t.get("fuelAmoun")),this.busChangeReason=r.observable(t.get("busChangeReason")),this.busSelected=r.observable(),this.driverList=r.observableArray(s.driver),this.driverSelected=r.observable(),this.alkhidmatCentreList=r.observableArray(s.alkhidmatCentre),this.alkhidmatCentreSelected=r.observable(),this.paymentLocationList=r.observableArray(s.alkhidmatCentre);var n=o.filter(s.alkhidmatCentre,function(e){return e.id==t.get("paymentLocation")}),l=o.filter(s.paymentType,function(e){return e.id==t.get("paymentType")}),d=o.filter(s.cashier,function(e){return e.id==t.get("officerId")});this.paymentLocationSelected=r.observable(n[0]),this.cashierList=r.observableArray(s.cashier),this.cashierSelected=r.observable(d[0]),this.paymentTypeList=r.observableArray(s.paymentType),this.paymentTypeSelected=r.observable(l[0]),this.currentDisplay=r.observable(),this.isEasyPaisa=r.computed({owner:this,read:function(){return void 0!=a.paymentTypeSelected()&&2===a.paymentTypeSelected().id&&""==a.easyPaisaTranNo().trim()?!0:!1}}),this.isPaid=r.computed({owner:this,read:function(){return"1"==a.paymentStatus()?!0:!1}}),this.isCancel=r.computed({owner:this,read:function(){return"2"==a.paymentStatus()?!0:!1}}),this.paymentStatusDesc=r.computed({owner:this,read:function(){return"1"==a.paymentStatus()?(a.currentDisplay("panel panel-default"),"Paid"):"2"==a.paymentStatus()?(a.currentDisplay("panel panel-danger"),"Cancel"):(a.currentDisplay("panel panel-warning"),"Unpaid")}}),this.alkhidmatCentreSelected.subscribe(function(){var t=o.filter(e,function(e){return e.centreId==a.alkhidmatCentreSelected().id});a.busList(t)})}}return e.prototype.FormatMoneyValue=function(e){void 0!=e()&&""!=e()&&e(i.FormatMoney(e()))},e.prototype.setOptionDisable=function(e,t){var i=t.description;(t.description.indexOf("Booked - Paid")>=0||t.description.indexOf("Booked - Unpaid")>=0)&&(i=t.description,r.applyBindingsToNode(e,{disable:!0,text:i},t)),t.isOnMaintainance&&(i=t.description+" - Maintenance",r.applyBindingsToNode(e,{disable:!0,text:i},t))},e}();t.ViewModel=b;var p=function(e){function t(t){s=a.Application.getInstance(),t.itemView=c,t.template=l.getOuterHTML("#gridTemplate"),t.itemViewContainer="tbody",e.call(this,t)}return __extends(t,e),t}(i.Views.CompositeView);t.BusVisitCollectionView=p;var c=function(e){function t(t){var i=this;t||(t={}),t.template=l.getOuterHTML("#rowTemplate"),t.tagName="tr",t.className="jsRowClick",t.events={"mouseover .jsShowDetail":"ShowDetail","click .jsShowDetail":"ShowDetail","click .jsRemoveItem":function(){return i.RemoveItem()},"click .jsUpdateItem":function(){return i.UpdateItem()}},e.call(this,t)}return __extends(t,e),t.prototype.RemoveItem=function(){this.trigger("BusVisitRemoveItem",this.model.get("busId"),this.model.get("centreId"),this.model.get("driverId"))},t.prototype.UpdateItem=function(){this.trigger("UpdateBusVisitItem",this.model)},t.prototype.ShowDetail=function(){},t}(i.Views.ItemView);t.BusVisitItemView=c});