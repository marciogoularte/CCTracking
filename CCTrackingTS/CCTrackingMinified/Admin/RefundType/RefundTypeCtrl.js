var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n};define(["require","exports","../../App","../../Helper","./RefundTypeView","../../Dtos/RefundTypeDto","../../DAL/RefundType","marionette","jquery","knockout","text!./RefundTypeTmpl.html"],function(e,t,n,o,i,d,l){var r=(e("underscore"),e("knockout")),p=e("knockback"),s=function(e){function t(){e.call(this),this.app=n.Application.getInstance(),this.backboneModel=new d.Models.RefundTypeDto,this.refundTypeViewModel=new i.RefundTypeViewModel(this.backboneModel,this),this.refundTypeView=new i.RefundTypeView({viewModel:this.refundTypeViewModel}),this.collection=new d.Models.RefundTypeCollection({}),this.collectionView=new i.RefundTypeCollectionView({collection:this.collection})}return __extends(t,e),t.prototype.Show=function(){var e=this,t=window.location.href;if(t.indexOf("id=")>-1){var n=t.substring(t.indexOf("id=")+3,t.length),o=l.GetById(n);o.done(function(t){return e.GetByIdCompleted(t)})}else this.Load()},t.prototype.Load=function(){var e=this,t=this.backboneModel;this.refundTypeViewModel.bbModel=t,this.refundTypeViewModel.model=p.viewModel(t),t.set("name",""),t.set("isActive",""),this.refundTypeViewModel=new i.RefundTypeViewModel(t,this),this.refundTypeView=new i.RefundTypeView({viewModel:this.refundTypeViewModel}),this.refundTypeView.on("SaveRefundType",function(){return e.Save(e.refundTypeViewModel.bbModel)}),this.refundTypeView.on("CancelForm",function(){return e.Cancel()}),this.app.MainRegion.show(this.refundTypeView)},t.prototype.GetAll=function(){var e=this,t=l.GetAll();t.done(function(t){return e.GetAllCompleted(t)})},t.prototype.GetByIdCompleted=function(e){var t=this;this.backboneModel=new Backbone.Model(e.refundTypeModel);var n=this.backboneModel;this.UIBinding(n),this.refundTypeView=new i.RefundTypeView({viewModel:this.refundTypeViewModel}),this.refundTypeView.on("SaveRefundType",function(){return t.Save(t.refundTypeViewModel.bbModel)}),this.refundTypeView.on("CancelForm",function(){return t.Cancel()}),this.app.MainRegion.show(this.refundTypeView)},t.prototype.Save=function(e){var t=this,n=this.app.request("AppGlobalSetting");e.set("modifiedBy",n.get("Id")),e.set("isActive","1"==e.get("isActive")?!0:!1);var o=l.Save(e);o.done(function(e){return t.SaveCompleted(e)})},t.prototype.GetAllCompleted=function(e){var t=this;this.collection.reset(e.refundTypeList),this.collectionView=new i.RefundTypeCollectionView({collection:this.collection}),this.collectionView.on("itemview:ShowDetail",function(e){return t.GetByIdCompleted(e.model)}),this.app.MainRegion.show(this.collectionView)},t.prototype.SaveCompleted=function(e){var t=new Backbone.Model(e);void 0!=t.get("errorMessage")&&""!=t.get("errorMessage").trim()?o.ShowModalPopup("danger","Refund Type","Due to some technical reason Refund Type have not been saved successfully!<br> Pelase try later"):(o.ShowModalPopup("success","Refund Type","Record has been saved successfully with RefundType ID : "+e.id),this.Cancel())},t.prototype.Cancel=function(){window.location.href="#viewRefundType"},t.prototype.UIBinding=function(e){e.set("isActive",e.get("isActive")?"1":"0"),this.refundTypeViewModel.bbModel=e,this.refundTypeViewModel.model=p.viewModel(e),r.cleanNode($(this.refundTypeView.el)[0]),r.applyBindings(this.refundTypeViewModel,this.refundTypeView.el)},t}(o.Controller);t.RefundTypeCtrl=s});