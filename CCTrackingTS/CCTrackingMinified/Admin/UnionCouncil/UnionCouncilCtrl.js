var __extends=this.__extends||function(e,n){function o(){this.constructor=e}for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i]);o.prototype=n.prototype,e.prototype=new o};define(["require","exports","../../App","../../Helper","./UnionCouncilView","../../Dtos/UnionCouncilDto","../../DAL/UnionCouncil","marionette","jquery","knockout","text!./UnionCouncilTmpl.html"],function(e,n,o,i,t,l,c){var s=e("underscore"),u=e("knockout"),d=e("knockback"),a=function(e){function n(){e.call(this),this.app=o.Application.getInstance(),this.backboneModel=new l.Models.UnionCouncilDto,this.unionCouncilViewModel=new t.UnionCouncilViewModel(this.backboneModel,this),this.unionCouncilView=new t.UnionCouncilView({viewModel:this.unionCouncilViewModel}),this.collection=new l.Models.UnionCouncilCollection({}),this.collectionView=new t.UnionCouncilCollectionView({collection:this.collection})}return __extends(n,e),n.prototype.Show=function(){var e=this,n=window.location.href;if(n.indexOf("id=")>-1){var o=n.substring(n.indexOf("id=")+3,n.length),i=c.GetById(o);i.done(function(n){return e.GetByIdCompleted(n)})}else this.Load()},n.prototype.Load=function(){var e=this,n=JSON.parse(localStorage.getItem("lookupResponse")),o=this.backboneModel;this.unionCouncilViewModel.bbModel=o,this.unionCouncilViewModel.model=d.viewModel(o),o.set("name",""),o.set("landmarkIdSelected",""),o.set("landmarkList",n.landmark),o.set("isActive",""),this.unionCouncilViewModel=new t.UnionCouncilViewModel(o,this),this.unionCouncilView=new t.UnionCouncilView({viewModel:this.unionCouncilViewModel}),this.unionCouncilView.on("SaveUnionCouncil",function(){return e.Save(e.unionCouncilViewModel.bbModel)}),this.unionCouncilView.on("CancelForm",function(){return e.Cancel()}),this.app.MainRegion.show(this.unionCouncilView)},n.prototype.GetAll=function(){var e=this,n=c.GetAll();n.done(function(n){return e.GetAllCompleted(n)})},n.prototype.GetByIdCompleted=function(e){var n=this;this.backboneModel=new Backbone.Model(e.unionCouncilModel);var o=this.backboneModel;this.UIBinding(o),this.unionCouncilView=new t.UnionCouncilView({viewModel:this.unionCouncilViewModel}),this.unionCouncilView.on("SaveUnionCouncil",function(){return n.Save(n.unionCouncilViewModel.bbModel)}),this.unionCouncilView.on("CancelForm",function(){return n.Cancel()}),this.app.MainRegion.show(this.unionCouncilView)},n.prototype.Save=function(e){var n=this,o=this.app.request("AppGlobalSetting");e.set("modifiedBy",o.get("Id")),e.set("landmarkId",e.get("landmarkIdSelected").id),e.set("isActive","1"==e.get("isActive")?!0:!1);var i=c.Save(e);i.done(function(e){return n.SaveCompleted(e)})},n.prototype.GetMinimalRequest=function(e){var n=new l.Models.UnionCouncilDto;return n.set("id",e.get("id")),n.set("townId",e.get("townId")),n.set("name",e.get("name")),n.set("isActive",e.get("isActive")),n.set("createdBy",e.get("createdBy")),n.set("createdDate",e.get("createdDate")),n.set("modifiedBy",e.get("modifiedBy")),n.set("modifiedDate",e.get("modifiedDate")),n},n.prototype.GetAllCompleted=function(e){var n=this;this.collection.reset(e.unionCouncilList),this.collectionView=new t.UnionCouncilCollectionView({collection:this.collection}),this.collectionView.on("itemview:ShowDetail",function(e){return n.GetByIdCompleted(e.model)}),this.app.MainRegion.show(this.collectionView)},n.prototype.SaveCompleted=function(e){var n=new Backbone.Model(e);void 0!=n.get("errorMessage")&&""!=n.get("errorMessage").trim()?i.ShowModalPopup("danger","Union Council","Due to some technical reason Union Council have not been saved successfully!<br> Pelase try later"):(i.ShowModalPopup("success","Union Council","Record has been saved successfully with UnionCouncil ID : "+e.id),this.Cancel())},n.prototype.Cancel=function(){window.location.href="#viewUnionCouncil"},n.prototype.UIBinding=function(e){var n=JSON.parse(localStorage.getItem("lookupResponse"));e.set("landmarkList",n.landmark);var o=s.filter(n.landmark,function(n){return n.id==e.get("landmarkId")});e.set("landmarkIdSelected",o[0]),e.set("isActive",e.get("isActive")?"1":"0"),this.unionCouncilViewModel.bbModel=e,this.unionCouncilViewModel.model=d.viewModel(e),u.cleanNode($(this.unionCouncilView.el)[0]),u.applyBindings(this.unionCouncilViewModel,this.unionCouncilView.el)},n}(i.Controller);n.UnionCouncilCtrl=a});