var __extends=this.__extends||function(e,i){function t(){this.constructor=e}for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n]);t.prototype=i.prototype,e.prototype=new t};define(["require","exports","../../App","../../Helper","./TrackingDeviceView","../../Dtos/TrackingDeviceDto","../../DAL/TrackingDevice","marionette","jquery","knockout","text!./TrackingDeviceTmpl.html"],function(e,i,t,n,o,c,r){var a=(e("underscore"),e("knockout")),l=e("knockback"),s=function(e){function i(){e.call(this),this.app=t.Application.getInstance(),this.backboneModel=new c.Models.TrackingDeviceDto,this.trackingDeviceViewModel=new o.TrackingDeviceViewModel(this.backboneModel,this),this.trackingDeviceView=new o.TrackingDeviceView({viewModel:this.trackingDeviceViewModel}),this.collection=new c.Models.TrackingDeviceCollection({}),this.collectionView=new o.TrackingDeviceCollectionView({collection:this.collection})}return __extends(i,e),i.prototype.Show=function(){var e=this,i=window.location.href;if(i.indexOf("id=")>-1){var t=i.substring(i.indexOf("id=")+3,i.length),n=r.GetById(t);n.done(function(i){return e.GetByIdCompleted(i)})}else this.Load()},i.prototype.Load=function(){var e=this,i=this.backboneModel;this.trackingDeviceViewModel.bbModel=i,this.trackingDeviceViewModel.model=l.viewModel(i),i.set("trackingNo",""),i.set("isActive",""),this.trackingDeviceViewModel=new o.TrackingDeviceViewModel(i,this),this.trackingDeviceView=new o.TrackingDeviceView({viewModel:this.trackingDeviceViewModel}),this.trackingDeviceView.on("SaveTrackingDevice",function(){return e.Save(e.trackingDeviceViewModel.bbModel)}),this.trackingDeviceView.on("CancelForm",function(){return e.Cancel()}),this.app.MainRegion.show(this.trackingDeviceView)},i.prototype.GetAll=function(){var e=this,i=r.GetAll();i.done(function(i){return e.GetAllCompleted(i)})},i.prototype.GetByIdCompleted=function(e){var i=this;this.backboneModel=new Backbone.Model(e.trackingDeviceModel);var t=this.backboneModel;this.UIBinding(t),this.trackingDeviceView=new o.TrackingDeviceView({viewModel:this.trackingDeviceViewModel}),this.trackingDeviceView.on("SaveTrackingDevice",function(){return i.Save(i.trackingDeviceViewModel.bbModel)}),this.trackingDeviceView.on("CancelForm",function(){return i.Cancel()}),this.app.MainRegion.show(this.trackingDeviceView)},i.prototype.Save=function(e){var i=this,t=this.app.request("AppGlobalSetting");e.set("modifiedBy",t.get("Id")),e.set("isActive","1"==e.get("isActive")?!0:!1);var n=r.Save(e);n.done(function(e){return i.SaveCompleted(e)})},i.prototype.GetAllCompleted=function(e){var i=this;this.collection.reset(e.trackingDeviceList),this.collectionView=new o.TrackingDeviceCollectionView({collection:this.collection}),this.collectionView.on("itemview:ShowDetail",function(e){return i.GetByIdCompleted(e.model)}),this.app.MainRegion.show(this.collectionView)},i.prototype.SaveCompleted=function(e){var i=new Backbone.Model(e);void 0!=i.get("errorMessage")&&""!=i.get("errorMessage").trim()?n.ShowModalPopup("danger","Tracking Device","Due to some technical reason Tracking Device have not been saved successfully!<br> Pelase try later"):(n.ShowModalPopup("success","Tracking Device","Record has been saved successfully with TrackingDevice ID : "+e.id),this.Cancel())},i.prototype.Cancel=function(){window.location.href="#viewTrackingDevice"},i.prototype.UIBinding=function(e){e.set("isActive",e.get("isActive")?"1":"0"),this.trackingDeviceViewModel.bbModel=e,this.trackingDeviceViewModel.model=l.viewModel(e),a.cleanNode($(this.trackingDeviceView.el)[0]),a.applyBindings(this.trackingDeviceViewModel,this.trackingDeviceView.el)},i}(n.Controller);i.TrackingDeviceCtrl=s});