var __extends=this.__extends||function(e,t){function o(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);o.prototype=t.prototype,e.prototype=new o};define(["require","exports","../../App","../../Helper","./GraveyardView","../../Dtos/GraveyardDto","../../DAL/Graveyard","marionette","jquery","knockout","text!./GraveyardTmpl.html"],function(e,t,o,a,r,i,n){var d=e("underscore"),l=e("knockout"),s=e("knockback"),c=function(e){function t(){e.call(this),this.app=o.Application.getInstance(),this.backboneModel=new i.Models.GraveyardDto,this.graveyardViewModel=new r.GraveyardViewModel(this.backboneModel,this),this.graveyardView=new r.GraveyardView({viewModel:this.graveyardViewModel}),this.collection=new i.Models.GraveyardCollection({}),this.collectionView=new r.GraveyardCollectionView({collection:this.collection})}return __extends(t,e),t.prototype.Show=function(){var e=this,t=window.location.href;if(t.indexOf("id=")>-1){var o=t.substring(t.indexOf("id=")+3,t.length),a=n.GetById(o);a.done(function(t){return e.GetByIdCompleted(t)})}else this.Load()},t.prototype.Load=function(){var e=this,t=JSON.parse(localStorage.getItem("lookupResponse")),o=this.backboneModel;this.graveyardViewModel.bbModel=o,this.graveyardViewModel.model=s.viewModel(o),o.set("name",""),o.set("landmarkIdSelected",""),o.set("landmarkList",t.landmark),o.set("isActive",""),this.graveyardViewModel=new r.GraveyardViewModel(o,this),this.graveyardView=new r.GraveyardView({viewModel:this.graveyardViewModel}),this.graveyardView.on("SaveGraveyard",function(){return e.Save(e.graveyardViewModel.bbModel)}),this.graveyardView.on("CancelForm",function(){return e.Cancel()}),this.app.MainRegion.show(this.graveyardView)},t.prototype.GetAll=function(){var e=this,t=n.GetAll();t.done(function(t){return e.GetAllCompleted(t)})},t.prototype.GetByIdCompleted=function(e){var t=this;this.backboneModel=new Backbone.Model(e.graveyardModel);var o=this.backboneModel;this.UIBinding(o),this.graveyardView=new r.GraveyardView({viewModel:this.graveyardViewModel}),this.graveyardView.on("SaveGraveyard",function(){return t.Save(t.graveyardViewModel.bbModel)}),this.graveyardView.on("CancelForm",function(){return t.Cancel()}),this.app.MainRegion.show(this.graveyardView)},t.prototype.Save=function(e){var t=this,o=this.app.request("AppGlobalSetting");e.set("modifiedBy",o.get("Id")),e.set("landmarkId",e.get("landmarkIdSelected").id),e.set("isActive","1"==e.get("isActive")?!0:!1);var a=n.Save(e);a.done(function(e){return t.SaveCompleted(e)})},t.prototype.GetAllCompleted=function(e){var t=this;this.collection.reset(e.graveyardList),this.collectionView=new r.GraveyardCollectionView({collection:this.collection}),this.collectionView.on("itemview:ShowDetail",function(e){return t.GetByIdCompleted(e.model)}),this.app.MainRegion.show(this.collectionView)},t.prototype.SaveCompleted=function(e){var t=new Backbone.Model(e);void 0!=t.get("errorMessage")&&""!=t.get("errorMessage").trim()?a.ShowModalPopup("danger","Graveyard","Due to some technical reason Graveyard have not been saved successfully!<br> Pelase try later"):(a.ShowModalPopup("success","Graveyard","Record has been saved successfully with Graveyard ID : "+e.id),this.Cancel())},t.prototype.Cancel=function(){window.location.href="#viewGraveyard"},t.prototype.UIBinding=function(e){var t=JSON.parse(localStorage.getItem("lookupResponse"));e.set("landmarkList",t.landmark);var o=d.filter(t.landmark,function(t){return t.id==e.get("landmarkId")});e.set("landmarkIdSelected",o[0]),e.set("isActive",e.get("isActive")?"1":"0"),this.graveyardViewModel.bbModel=e,this.graveyardViewModel.model=s.viewModel(e),l.cleanNode($(this.graveyardView.el)[0]),l.applyBindings(this.graveyardViewModel,this.graveyardView.el)},t}(a.Controller);t.GraveyardCtrl=c});