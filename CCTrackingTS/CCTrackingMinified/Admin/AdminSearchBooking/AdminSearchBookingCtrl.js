var __extends=this.__extends||function(o,e){function t(){this.constructor=o}for(var i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);t.prototype=e.prototype,o.prototype=new t};define(["require","exports","../../App","../../Helper","./AdminSearchBookingView","../../Dtos/BookingSummaryDto","../../Dtos/ReportDto","../../DAL/AdminSearch","marionette","jquery","knockout"],function(o,e,t,i,n,r,a,c){var l=(o("underscore"),o("knockout")),s=o("knockback"),h=function(o){function e(){o.call(this),this.app=t.Application.getInstance(),this.backboneModel=new r.Models.BookingSummaryDto,this.searchViewModel=new n.SearchViewModel(this.backboneModel,this),this.compositeModel=new Backbone.Model,this.backboneCollection=new Backbone.Collection([]),this.collectionView=new n.SearchCollectionView({collection:this.backboneCollection,model:this.compositeModel}),this.backboneCollection.reset([])}return __extends(e,o),e.prototype.Show=function(){this.Load()},e.prototype.Load=function(){var o=this,e=this.backboneModel;e.set("fromBookingDate",i.FormatDateString(Date.now())),e.set("toBookingDate",i.FormatDateString(Date.now())),this.compositeModel=e,this.collectionView.listenTo(this.collectionView,"AdminSearchBooking",function(){return o.GetByCriteria(o.searchViewModel.bbModel)}),this.collectionView.listenTo(this.collectionView,"itemview:CentreBusSummary",function(t,i){o.ShowCentreBusSummary(i,e)}),this.collectionView.on("CancelForm",function(){return o.Cancel()}),this.app.MainRegion.show(this.collectionView);var t=s.viewModel(this.compositeModel),n=$("#txtFromBookingDate")[0];l.cleanNode(n),l.applyBindings(t,n);var r=$("#txtToBookingDate")[0];l.cleanNode(r),l.applyBindings(t,r)},e.prototype.ShowCentreBusSummary=function(o,e){var t=new a.Models.ReportDto;t.set("fromDate",e.get("fromBookingDate")),t.set("toDate",e.get("toBookingDate")),t.set("centreId",o),this.app.reqres.setHandler("ReportFilterSetting",function(){return t},this),location.href="#busCentreReport"},e.prototype.GetByCriteria=function(o){var e=this;""!=o.get("fromBookingDate").trim()&&o.set("fromBookingDate",i.FormatDateString(o.get("fromBookingDate"))),""!=o.get("toBookingDate").trim()&&o.set("toBookingDate",i.FormatDateString(o.get("toBookingDate")));var t=c.GetByCriteria(o);t.done(function(o){return e.GetByCriteriaCompleted(o)})},e.prototype.GetByCriteriaCompleted=function(o){for(var e=o.bookingSummaryList,t=[],n=0;n<e.length;n++)t[n]={alkhidmatCentre:e[n].alkhidmatCentre,alkhidmatCentreId:e[n].alkhidmatCentreId,bookingAmount:i.FormatMoney(e[n].bookingAmount),bookingMilage:e[n].bookingMilage,bookings:e[n].bookings,receivables:i.FormatMoney(e[n].receivables)};this.backboneCollection.reset(t)},e.prototype.Cancel=function(){window.location.href="#adminSearchBooking"},e}(i.Controller);e.AdminSearchBookingCtrl=h});