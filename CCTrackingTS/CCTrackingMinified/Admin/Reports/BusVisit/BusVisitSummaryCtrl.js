var __extends=this.__extends||function(i,t){function e(){this.constructor=i}for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o]);e.prototype=t.prototype,i.prototype=new e};define(["require","exports","../../../App","../../../Helper","./BusVisitSummaryView","../../../Dtos/BusVisitDto","../../../DAL/BusVisit","marionette","jquery","knockout"],function(i,t,e,o,s,n,l){var r=(i("underscore"),i("knockout"),i("knockback"),function(i){function t(){i.call(this),this.app=e.Application.getInstance(),this.backboneModel=new n.Models.BusVisitSummaryDto,this.compositeModel=new Backbone.Model,this.backboneCollection=new Backbone.Collection([]),this.collectionView=new s.BusVisitSummaryCollectionView({collection:this.backboneCollection,model:new Backbone.Model({title1:""})}),this.backboneCollection.reset([])}return __extends(t,i),t.prototype.ShowVisit=function(){var i=this;this.isBusVisit=!0;var t=l.GetAllSummary();t.done(function(t){return i.GetBusVisitSummaryCompleted(t)}),this.collectionView.model=new Backbone.Model({title1:"Visit"}),this.app.MainRegion.show(this.collectionView),this.collectionView.listenTo(this.collectionView,"itemview:BusVisitSummaryDetail",function(t,e){return i.GetBusVisitDetial(e)})},t.prototype.ShowMilage=function(){var i=this;this.isBusVisit=!1;var t=l.GetAllMilageSummary();t.done(function(t){return i.GetBusVisitSummaryCompleted(t)}),this.collectionView.model=new Backbone.Model({title1:"Milage"}),this.app.MainRegion.show(this.collectionView),this.collectionView.listenTo(this.collectionView,"itemview:BusVisitSummaryDetail",function(t,e){return i.GetBusVisitMilageDetial(e)})},t.prototype.GetBusVisitDetial=function(i){var t=this,e=l.GetAllDetail(i);e.done(function(i){return t.GetBusVisitDetailCompleted(i)})},t.prototype.GetBusVisitMilageDetial=function(i){var t=this,e=l.GetAllMilageDetail(i);e.done(function(i){return t.GetBusVisitDetailCompleted(i)})},t.prototype.GetBusVisitDetailCompleted=function(i){for(var t=i.busVisitList,e=[],n=0;n<t.length;n++)e[n]={driverDesc:t[n].driverDesc,centreDesc:t[n].centreDesc,vehicleNo:t[n].vehicleNo,visitDate:o.FormatDateString(t[n].visitDate),visitInterval:t[n].visitInterval,bookingId:t[n].bookingId,milage:t[n].milage};var l=new Backbone.Collection([]),r=new s.BusVisitDetailCollectionView({collection:l});this.app.MainRegion.show(r),l.reset(e),location.href=this.isBusVisit?"#busVisitDetail":"#busVisitMilageDetail"},t.prototype.GetBusVisitSummaryCompleted=function(i){for(var t=i.busVisitList,e=[],o=0;o<t.length;o++)e[o]={busId:t[o].busId,driverDesc:t[o].driverDesc,milage:t[o].milage,visitCount:t[o].visitCount,vehicleNo:t[o].vehicleNo};this.backboneCollection.reset(e)},t.prototype.Cancel=function(){location.href=this.isBusVisit?"#busVisitSummary":"#busVisitMilageSummary"},t}(o.Controller));t.BusVisitSummaryCtrl=r});