var __extends=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o};define(["require","exports","../../../App","../../../Helper","./BusFuelingReportView","../../../Dtos/BookingSummaryDto","../../../Dtos/ReportDto","../../../DAL/BusFuelingReport","marionette","jquery","knockout"],function(e,t,o,i,n,r,a,s){var l=(e("underscore"),e("knockout")),c=e("knockback"),u=function(e){function t(){e.call(this),this.app=o.Application.getInstance(),this.backboneModel=new r.Models.BookingSummaryDto,this.searchViewModel=new n.SearchViewModel(this.backboneModel,this),this.compositeModel=new Backbone.Model,this.backboneCollection=new Backbone.Collection([]),this.collectionView=new n.SearchCollectionView({collection:this.backboneCollection,model:this.compositeModel}),this.backboneCollection.reset([])}return __extends(t,e),t.prototype.Show=function(){this.Load()},t.prototype.Load=function(){var e=this,t=JSON.parse(localStorage.getItem("lookupResponse")),o=this.backboneModel;o.set("fromBookingDate",i.FormatDateString(Date.now())),o.set("toBookingDate",i.FormatDateString(Date.now())),o.set("busList",t.bus),o.set("busSelected",""),this.compositeModel=o,this.collectionView.listenTo(this.collectionView,"BusFuelingReport",function(){return e.GetByCriteria(e.searchViewModel.bbModel)}),this.collectionView.listenTo(this.collectionView,"itemview:BusVisitDetails",function(t,i){e.ShowBusVisitDetails(i,o)}),this.collectionView.on("CancelForm",function(){return e.Cancel()}),this.app.MainRegion.show(this.collectionView);var n=this.collectionView.$el,r=c.viewModel(this.compositeModel),a=n.find("#txtFromBookingDate")[0];l.cleanNode(a),l.applyBindings(r,a);var s=n.find("#txtToBookingDate")[0];l.cleanNode(s),l.applyBindings(r,s);var u=n.find("#ddlBusDetails")[0];l.cleanNode(u),l.applyBindings(r,u)},t.prototype.ShowBusVisitDetails=function(e,t){var o=new a.Models.ReportDto;o.set("fromDate",t.get("fromBookingDate")),o.set("toDate",t.get("toBookingDate")),o.set("busId",e),this.app.reqres.setHandler("ReportFilterSetting",function(){return o},this),location.href="#busMilageReport"},t.prototype.GetByCriteria=function(e){var t=this;""!=e.get("fromBookingDate").trim()&&e.set("fromBookingDate",i.FormatDateString(e.get("fromBookingDate"))),""!=e.get("toBookingDate").trim()&&e.set("toBookingDate",i.FormatDateString(e.get("toBookingDate"))),void 0!=e.get("busSelected")&&e.set("busId",e.get("busSelected").id);var o=s.GetByCriteria(this.GetMinimalRequest(e));o.done(function(e){return t.GetByCriteriaCompleted(e)})},t.prototype.GetMinimalRequest=function(e){var t=new r.Models.BookingSummaryDto;return t.set("fromBookingDate",e.get("fromBookingDate")),t.set("toBookingDate",e.get("toBookingDate")),t.set("busSelected",e.get("busSelected")),t.set("busId",e.get("busId")),t},t.prototype.GetByCriteriaCompleted=function(e){for(var t=e.bookingSummaryList,o=[],n=0;n<t.length;n++)o[n]={alkhidmatCentre:t[n].alkhidmatCentre,bookingAmount:i.FormatMoney(t[n].bookingAmount),bookingMilage:i.FormatMoney(t[n].bookingMilage),busNo:t[n].busNo,busId:t[n].busId,currentReading:i.FormatMoney(t[n].currentReading),previusReading:i.FormatMoney(t[n].previusReading),fuelQuantity:i.FormatMoney(t[n].fuelQuantity),fuelRate:i.FormatMoney(t[n].fuelRate),averageMilage:i.FormatMoney(t[n].averageMilage),pumpLocation:t[n].pumpLocation,visitType:t[n].visitType,visitDate:i.FormatDateString(t[n].visitDate),outTime:t[n].outTime,inTime:t[n].inTime,timeTaken:t[n].timeTaken,driver:t[n].driver,fuelingReceipt:t[n].fuelingReceipt};this.backboneCollection.reset(o)},t.prototype.Cancel=function(){window.location.href="#busCentreReport"},t}(i.Controller);t.BusFuelingReportCtrl=u});