var __extends=this.__extends||function(o,e){function t(){this.constructor=o}for(var i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);t.prototype=e.prototype,o.prototype=new t};define(["require","exports","../../../../App","../../../../Helper","./AuditBookingView","../../../../Dtos/BookingDto","../../../../DAL/Booking","marionette","jquery","knockout"],function(o,e,t,i,n,a,r){var l=(o("underscore"),o("knockout")),c=o("knockback"),s=function(o){function e(){o.call(this),this.app=t.Application.getInstance(),this.backboneModel=new a.Models.AuditBooking,this.compositeModel=new Backbone.Model,this.backboneCollection=new Backbone.Collection([]),this.collectionView=new n.AuditBookingCollectionView({collection:this.backboneCollection}),this.backboneCollection.reset([])}return __extends(e,o),e.prototype.Show=function(){var o=this,e=this.backboneModel;e.set("fromDate",i.FormatDateString(Date.now())),e.set("toDate",i.FormatDateString(Date.now())),this.compositeModel=e,this.collectionView.model=e,this.app.MainRegion.show(this.collectionView),this.collectionView.listenTo(this.collectionView,"Event:AuditBooking",function(e){return o.GetAuditBookingDetial(e)});var t=c.viewModel(this.compositeModel),n=$("#txtFromDate")[0];l.cleanNode(n),l.applyBindings(t,n);var a=$("#txtToDate")[0];l.cleanNode(a),l.applyBindings(t,a)},e.prototype.GetAuditBookingDetial=function(o){var e=this,t=new Backbone.Model(o);if(""==t.get("fromDate")||""==t.get("toDate"))return void i.ShowModalPopup("danger","Audit Booking","Please enter valid search criteria");var n=r.GetAllAuditBooking(t);n.done(function(o){return e.AuditBookingCompleted(o)})},e.prototype.AuditBookingCompleted=function(o){for(var e=o.auditBookingDisplayList,t=[],n=0;n<e.length;n++)t[n]={bookingId:e[n].bookingId,userName:e[n].userName,propertyName:e[n].propertyName,oldValue:e[n].oldValue,newValue:e[n].newValue,actualModifiedDate:i.FormatDateString(e[n].actualModifiedDate),rowCounter:e[n].rowCounter};this.backboneCollection.reset(t)},e}(i.Controller);e.AuditBookingCtrl=s});