var __extends=this.__extends||function(t,e){function o(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);o.prototype=e.prototype,t.prototype=new o};define(["require","exports","../../../../App","../../../../Helper","./AuditBusVisitView","../../../../Dtos/BusVisitDto","../../../../DAL/BusVisit","marionette","jquery","knockout"],function(t,e,o,i,n,s,a){var r=(t("underscore"),t("knockout")),l=t("knockback"),c=function(t){function e(){t.call(this),this.app=o.Application.getInstance(),this.backboneModel=new s.Models.AuditBusVisit,this.compositeModel=new Backbone.Model,this.backboneCollection=new Backbone.Collection([]),this.collectionView=new n.AuditBusVisitCollectionView({collection:this.backboneCollection}),this.backboneCollection.reset([])}return __extends(e,t),e.prototype.Show=function(){var t=this,e=this.backboneModel;e.set("fromDate",i.FormatDateString(Date.now())),e.set("toDate",i.FormatDateString(Date.now())),this.compositeModel=e,this.collectionView.model=e,this.app.MainRegion.show(this.collectionView),this.collectionView.listenTo(this.collectionView,"Event:AuditBusVisit",function(e){return t.GetAuditBusVisitDetial(e)});var o=l.viewModel(this.compositeModel),n=$("#txtFromDate")[0];r.cleanNode(n),r.applyBindings(o,n);var s=$("#txtToDate")[0];r.cleanNode(s),r.applyBindings(o,s)},e.prototype.GetAuditBusVisitDetial=function(t){var e=this,o=new Backbone.Model(t);if(""==o.get("fromDate")||""==o.get("toDate"))return void i.ShowModalPopup("danger","Audit Booking","Please enter valid search criteria");var n=a.GetAllAuditBusVisit(o);n.done(function(t){return e.AuditBusVisitCompleted(t)})},e.prototype.AuditBusVisitCompleted=function(t){for(var e=t.auditBusVisitDisplayList,o=[],n=0;n<e.length;n++)o[n]={bookingId:e[n].bookingId,userName:e[n].userName,propertyName:e[n].propertyName,oldValue:e[n].oldValue,newValue:e[n].newValue,actualModifiedDate:i.FormatDateString(e[n].actualModifiedDate),rowCounter:e[n].rowCounter};this.backboneCollection.reset(o)},e}(i.Controller);e.AuditBusVisitCtrl=c});