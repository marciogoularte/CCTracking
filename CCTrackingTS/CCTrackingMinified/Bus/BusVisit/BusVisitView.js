var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i};define(["require","exports","../../Helper","marionette","jquery","knockout","text!./BusVisit.html","text!./BusVisitGrid.html"],function(e,t,i){var s=e("underscore"),o=e("knockout"),r=e("text!./BusVisit.html"),l=e("text!./BusVisitGrid.html"),n=function(e){function t(t){this.template=l.getOuterHTML("#BusVisitLayout"),this.regions={SearchRegion:{selector:".rgnSearch"},ContentRegion:{selector:".rgnContent"}},e.call(this,t)}return __extends(t,e),t}(Marionette.Layout);t.SearchBusVisitLayoutView=n;var a=function(e){function t(t){this.itemView=d,this.template=l.getOuterHTML("#gridTemplate"),this.itemViewContainer="tbody",e.call(this,t)}return __extends(t,e),t.prototype.onShow=function(){this.dataTable=this.$el.find("#tblStation").dataTable({autoWidth:!1,info:!0,processing:!0,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{paginate:{next:"Next",previous:"Prev"},emptyTable:"",infoEmpty:"",zeroRecords:"No record found!"},pageLength:i.GetPageSize()})},t}(i.Views.CompositeView);t.BusVisitCollectionView=a;var d=function(e){function t(t){t||(t={}),t.template=l.getOuterHTML("#rowTemplate"),t.tagName="tr",t.className="jsRowClick",t.events={"click .jsShowDetail":"EditBusVisit"},e.call(this,t)}return __extends(t,e),t.prototype.EditBusVisit=function(){window.location.href="#editBusVisit",this.trigger("Event:EditForm",this.model.get("id"))},t}(i.Views.ItemView);t.BusVisitItemView=d;var b=function(e){function t(t){this.template=l.getOuterHTML("#SearchPanel"),this.events={"click .jsSearchVisit":"SearchVisit"},e.call(this,t)}return __extends(t,e),t.prototype.SearchVisit=function(e){e.preventDefault(),this.trigger("Event:SearchVisit",this.model.get("busSelected").id)},t}(i.Views.ItemView);t.BusVisitSearchItemView=b;var h=function(e){function t(t){this.template=r,this.viewModel=new v(t),this.bbModel=new Backbone.Model,this.events={submit:"Save","click .jsCancel":"Cancel"},e.call(this,t)}return __extends(t,e),t.prototype.close=function(){},t.prototype.Cancel=function(){this.trigger("Event:CancelForm")},t.prototype.Save=function(e){if(e.preventDefault(),!this.viewModel.isValidReading())return i.ShowModalPopup("danger","Bus Visit","Please enter valid reading! Final reading should be greather than the Initial reading!"),!1;if("1"==this.viewModel.isBookingCompleted()){if(void 0==this.viewModel.returnDate()||""==this.viewModel.returnDate())return i.ShowModalPopup("danger","Bus Visit","Please enter valid return date to complete the booking."),!1;if(void 0==this.viewModel.finalReading()||""==this.viewModel.finalReading()||0==this.viewModel.finalReading())return i.ShowModalPopup("danger","Bus Visit","Please enter valid final reading to complete the booking."),!1}this.bbModel.set("id",this.viewModel.id()),this.bbModel.set("isActive","1"==this.viewModel.isActive()?!0:!1),this.bbModel.set("bookingId",this.viewModel.bookingId()),this.bbModel.set("inchargeName",this.viewModel.inchargeName()),this.bbModel.set("visitDate",this.viewModel.visitDate()),this.bbModel.set("returnDate",this.viewModel.returnDate()),this.bbModel.set("readingWhenFilling",this.viewModel.readingWhenFilling()),this.bbModel.set("pumpLocation",this.viewModel.pumpLocation()),this.bbModel.set("fuelRate",this.viewModel.fuelRate()),this.bbModel.set("fuelQuantity",this.viewModel.fuelQuantity()),this.bbModel.set("fuelAmount",this.viewModel.fuelAmount()),this.bbModel.set("fuelingReceipt",this.viewModel.fuelingReceipt()),this.bbModel.set("isBookingCompleted",this.viewModel.isBookingCompleted()),this.bbModel.set("description",this.viewModel.description()),this.bbModel.set("initialReading",this.viewModel.initialReading()),this.bbModel.set("finalReading",this.viewModel.finalReading()),this.bbModel.set("busDesc",this.viewModel.busDesc()),this.bbModel.set("centreDesc",this.viewModel.centreDesc()),this.bbModel.set("driverDesc",this.viewModel.driverDesc()),this.bbModel.set("visitTypeDesc",this.viewModel.visitTypeDesc()),this.bbModel.set("centreId",this.viewModel.alkhidmatCentreSelected().id),this.bbModel.set("driverId",this.viewModel.driverSelected().id),this.bbModel.set("busId",this.viewModel.busSelected().id),this.bbModel.set("outTime",this.viewModel.outTimeSlotSelected().id),this.bbModel.set("returnTime",this.viewModel.returnTimeSlotSelected().id),this.bbModel.set("visitTypeId",this.viewModel.visitTypeSelected().id),this.trigger("Event:SaveForm",this.bbModel)},t.prototype.onShow=function(){o.applyBindings(this.viewModel,this.el)},t}(i.Views.ItemView);t.BusVisitView=h;var v=function(){function e(e){var t=this,r=JSON.parse(localStorage.getItem("lookupResponse"));if(this.outTimeSlotList=o.observableArray(r.timeSlot),this.reutrnTimeSlotList=o.observableArray(r.timeSlot),this.busList=o.observableArray(r.bus),this.driverList=o.observableArray(r.driver),this.alkhidmatCentreList=o.observableArray(r.alkhidmatCentre),this.visitTypeList=o.observableArray(r.visitType),void 0==e)this.id=o.observable(),this.isEdit=o.observable(!1),this.isActive=o.observable("1"),this.centreId=o.observable(),this.busId=o.observable(),this.driverId=o.observable(),this.visitTypeId=o.observable(),this.bookingId=o.observable(),this.inchargeName=o.observable(),this.visitDate=o.observable(),this.outTime=o.observable(),this.returnTime=o.observable(),this.returnDate=o.observable(),this.readingWhenFilling=o.observable(),this.pumpLocation=o.observable(),this.fuelRate=o.observable(),this.fuelAmount=o.observable(),this.fuelQuantity=o.observable(),this.fuelingReceipt=o.observable(),this.isBookingCompleted=o.observable(),this.description=o.observable(),this.initialReading=o.observable(),this.finalReading=o.observable(),this.busDesc=o.observable(),this.centreDesc=o.observable(),this.driverDesc=o.observable(),this.visitTypeDesc=o.observable(),this.outTimeSlotSelected=o.observable(),this.returnTimeSlotSelected=o.observable(),this.busSelected=o.observable(),this.driverSelected=o.observable(),this.alkhidmatCentreSelected=o.observable(),this.visitTypeSelected=o.observable(),this.isPatrolPump=o.computed({owner:this,read:function(){return void 0!=t.visitTypeSelected()&&i.VisitTypes[t.visitTypeSelected().id]==i.VisitTypes[1]?!0:!1}}),this.isMaintenance=o.computed({owner:this,read:function(){return void 0!=t.visitTypeSelected()&&i.VisitTypes[t.visitTypeSelected().id]==i.VisitTypes[3]?!0:!1}}),this.isBooking=o.computed({owner:this,read:function(){return void 0!=t.visitTypeSelected()&&i.VisitTypes[t.visitTypeSelected().id]==i.VisitTypes[2]?!0:!1}});else{this.id=o.observable(e.get("id")),this.isEdit=o.observable(!0),this.isActive=o.observable(e.get("isActive")),this.centreId=o.observable(e.get("centreId")),this.busId=o.observable(e.get("busId")),this.driverId=o.observable(e.get("drvierId")),this.visitTypeId=o.observable(e.get("visitTypeId")),this.bookingId=o.observable(e.get("bookingId")),this.inchargeName=o.observable(e.get("inchargeName")),this.visitDate=o.observable(e.get("visitDate")),this.outTime=o.observable(e.get("outTime")),this.returnTime=o.observable(e.get("returnTime")),this.returnDate=o.observable(e.get("returnDate")),this.readingWhenFilling=o.observable(e.get("readingWhenFilling")),this.pumpLocation=void 0!=e.get("pumpLocation")&&""==e.get("pumpLocation").trim()?o.observable():o.observable(e.get("pumpLocation")),this.fuelRate=void 0!=e.get("fuelRate")&&"0"==e.get("fuelRate")?o.observable():o.observable(e.get("fuelRate")),this.fuelAmount=void 0!=e.get("fuelAmount")&&"0"==e.get("fuelAmount")?o.observable():o.observable(e.get("fuelAmount")),this.fuelQuantity=void 0!=e.get("fuelQuantity")&&"0"==e.get("fuelQuantity")?o.observable():o.observable(e.get("fuelQuantity")),this.fuelingReceipt=void 0!=e.get("fuelingReceipt")&&""==e.get("fuelingReceipt")?o.observable():o.observable(e.get("fuelingReceipt"));var l=1==e.get("isBookingCompleted")?"1":"0";this.isBookingCompleted=o.observable(l),this.description=o.observable(e.get("description")),this.initialReading=o.observable(e.get("initialReading")),this.finalReading=o.observable(e.get("finalReading")),this.busDesc=o.observable(e.get("busDesc")),this.centreDesc=o.observable(e.get("centreDesc")),this.driverDesc=o.observable(e.get("driverDesc")),this.visitTypeDesc=o.observable(e.get("visitTypeDesc"));var n=s.filter(r.timeSlot,function(t){return t.id==e.get("outTime")}),a=s.filter(r.timeSlot,function(t){return t.id==e.get("returnTime")}),d=s.filter(r.bus,function(t){return t.id==e.get("busId")}),b=s.filter(r.driver,function(t){return t.id==e.get("driverId")}),h=s.filter(r.alkhidmatCentre,function(t){return t.id==e.get("centreId")}),v=s.filter(r.visitType,function(t){return t.id==e.get("visitTypeId")});this.outTimeSlotSelected=o.observable(n[0]),this.returnTimeSlotSelected=o.observable(a[0]),this.busSelected=o.observable(d[0]),this.driverSelected=o.observable(b[0]),this.alkhidmatCentreSelected=o.observable(h[0]),this.visitTypeSelected=o.observable(v[0]),this.isPatrolPump=o.computed({owner:this,read:function(){return void 0!=t.visitTypeSelected()&&i.VisitTypes[t.visitTypeSelected().id]==i.VisitTypes[1]?!0:!1}}),this.isMaintenance=o.computed({owner:this,read:function(){return void 0!=t.visitTypeSelected()&&i.VisitTypes[t.visitTypeSelected().id]==i.VisitTypes[3]?!0:!1}}),this.isBooking=o.computed({owner:this,read:function(){return void 0!=t.visitTypeSelected()&&i.VisitTypes[t.visitTypeSelected().id]==i.VisitTypes[2]?!0:!1}})}this.isValidReading=o.computed({owner:this,read:function(){return void 0!=t.finalReading()&&0==t.finalReading()?!0:void 0!=t.initialReading()&&void 0!=t.finalReading()&&parseInt(t.initialReading())>parseInt(t.finalReading())?!1:!0}})}return e}();t.ViewModel=v});