var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);i.prototype=t.prototype,e.prototype=new i};define(["require","exports","../App","../Helper","./BusAvailabilityView","../Dtos/BusAvailabilityDto","../DAL/BusAvailability","marionette","jquery","knockout"],function(e,t,i,o,l,n,s){var a=e("underscore"),c=(e("knockout"),e("knockback"),function(e){function t(){e.call(this),this.app=i.Application.getInstance(),this.backboneModel=new n.Models.BusAvailabilityDto,this.viewModel=new l.BusAvailabilityViewModel(this.backboneModel,this),this.view=new l.BusAvailabilityView({viewModel:this.viewModel}),this.collection=new n.Models.BusAvailabilityCollection({id:"",busList:"",centreName:""}),this.collectionView=new l.BusAvailabilityCollectionView({collection:this.collection}),this.compositeModel=new Backbone.Model}return __extends(t,e),t.prototype.Show=function(){var e=this,t=JSON.parse(localStorage.getItem("lookupResponse")),i=this.backboneModel;i.set("alkhidmatCentreList",t.alkhidmatCentre),i.set("alkhidmatCentreSelected",""),i.set("busList",t.bus),i.set("busSelected",""),this.viewModel=new l.BusAvailabilityViewModel(i,this),this.view=new l.BusAvailabilityView({viewModel:this.viewModel}),this.view.model=i,this.view.listenTo(this.view,"Event:BusAvailability",function(t){return e.BusAvailability(t)}),this.collectionView.listenTo(this.collectionView,"itemview:Event:BusBookingDetail",function(t,i){return e.ShowBusBookingDetail(i)}),this.app.RightRegion.show(this.view),this.app.BusAvailabilityRegion.show(this.collectionView)},t.prototype.ShowBusBookingDetail=function(e){var t=this,i=s.GetById(e);i.done(function(e){return t.ShowBusBookingDetailCompleted(e)})},t.prototype.ShowBusBookingDetailCompleted=function(e){var t=a.map(e.nearestCentreList,function(e){return e.pickupDate=o.FormatDateString(e.pickupDate),e}),i=new Backbone.Collection(t),l=new Backbone.Model;l.set("type","btn-primary"),l.set("message",""),o.ShowBusDetailModalPopup(l,i)},t.prototype.BusAvailability=function(e){var t=this,i=s.GetAll(e);i.done(function(e){return t.GetAllCompleted(e)})},t.prototype.GetAllCompleted=function(e){this.collection.reset(e.nearestCentreList),this.collectionView.collection=this.collection},t}(o.Controller));t.BusAvailabilityCtrl=c});