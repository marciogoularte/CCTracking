var __extends=this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);o.prototype=t.prototype,e.prototype=new o};define(["require","exports","../App","../Helper","./HomeView","../Dtos/HomeDto","../DAL/Home","../DAL/AdminSearch","marionette","jquery","knockout"],function(e,t,o,n,a,i,r,s){var m=e("underscore"),l=(e("knockout"),e("knockback"),function(e){function t(){e.call(this),this.app=o.Application.getInstance(),this.homeItemView=new a.HomeItemView}return __extends(t,e),t.prototype.Show=function(){var e=this;this.app.MainRegion.show(this.homeItemView);var t=new i.Models.HomeDto,o=new Date,a=new Date(o.setDate(o.getDate()-30));t.set("fromDate",n.FormatDateString(a)),t.set("toDate",n.FormatDateString(new Date));var s=r.GetByCriteria(t);s.done(function(t){e.ShowChart(t)}),this.ShowCentreSummaryReport()},t.prototype.ShowCentreSummaryReport=function(){var e=new Backbone.Model,t=new Date,o=new Date(t.setDate(t.getDate()-30));e.set("fromBookingDate",n.FormatDateString(o)),e.set("toBookingDate",n.FormatDateString(new Date)),this.GetByCriteria(e)},t.prototype.GetByCriteria=function(e){var t=this;""!=e.get("fromBookingDate").trim()&&e.set("fromBookingDate",n.FormatDateString(e.get("fromBookingDate"))),""!=e.get("toBookingDate").trim()&&e.set("toBookingDate",n.FormatDateString(e.get("toBookingDate")));var o=s.GetByCriteria(e);o.done(function(e){return t.GetByCriteriaCompleted(e)})},t.prototype.GetByCriteriaCompleted=function(e){for(var t=e.bookingSummaryList,o=[],i=0,r=0,s=0,m=0,l=0,c=0;c<t.length;c++)o[c]={alkhidmatCentre:t[c].alkhidmatCentre,alkhidmatCentreId:t[c].alkhidmatCentreId,bookingAmount:n.FormatMoney(t[c].bookingAmount),maintenance:n.FormatMoney(t[c].maintenance),bookingMilage:n.FormatMoney(t[c].bookingMilage),bookings:t[c].bookings,receivables:n.FormatMoney(t[c].receivables)},i+=parseFloat(t[c].bookingAmount),l+=parseFloat(t[c].maintenance),r+=parseFloat(t[c].bookingMilage),s+=parseInt(t[c].bookings),m+=parseFloat(t[c].receivables);var p=new Backbone.Model({totalBookingAmount:n.FormatMoney(i),totalBookingMilage:n.FormatMoney(r),totalMaintenance:n.FormatMoney(l),totalBookings:s,totalReceivables:n.FormatMoney(m)});this.collectionView=new a.SearchCollectionView({collection:new Backbone.Collection(o),model:p}),this.app.SubRegion.reset(),this.app.SubRegion.show(this.collectionView)},t.prototype.ShowChart=function(e){var t=[],o=[],n=[],a=[],i=[];m.map(e.homeList,function(e){return t.push(e.centreDesc),o.push(e.bookingAmount),n.push(e.maintenance),a.push(e.receivable),i.push(e.profit),e}),this.homeItemView.$el.find("#container").highcharts({chart:{type:"column",backgroundColor:"transparent",options3d:{enabled:!0,alpha:15,beta:15,viewDistance:25,depth:40},marginTop:80,marginRight:40},title:{text:"Booking Summary Report - Centre Wise",style:{color:"grey"}},xAxis:{categories:t},legend:{itemStyle:{color:"grey"}},yAxis:{allowDecimals:!1,min:0,title:{text:"Amount in Rs"}},tooltip:{headerFormat:"<b>{point.key}</b><br>",pointFormat:'<span style="color:{series.color}">‚óè</span> {series.name}: {point.y}'},plotOptions:{column:{stacking:"normal",depth:40}},series:[{name:"Booking",data:o,stack:"Booking"},{name:"Maintenance",data:n,stack:"Maintenance"},{name:"Receivable",data:a,stack:"Receivable"},{name:"Profit",data:i,stack:"Profit"}]});var r=this.homeItemView.$el.find("text")[this.homeItemView.$el.find("text").length-1];void 0!=r&&(r.innerHTML="")},t}(n.Controller));t.HomeCtrl=l});