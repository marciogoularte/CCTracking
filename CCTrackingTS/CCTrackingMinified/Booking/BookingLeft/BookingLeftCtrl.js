var __extends=this.__extends||function(o,e){function t(){this.constructor=o}for(var i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);t.prototype=e.prototype,o.prototype=new t};define(["require","exports","../../App","../../Helper","./BookingLeftView","../../Dtos/BookingLeftDto","../../DAL/BookingLeft","../../DAL/ReceiptContent","../BookingCtrl","marionette","jquery","knockout","text!./BookingLeftTmpl.html","jsPDF","printArea"],function(o,e,t,i,n,r,p,a,l){var s=o("underscore"),g=o("knockout"),d=o("knockback"),w=o("jsPDF"),c=(o("printArea"),function(o){function e(){o.call(this),this.app=t.Application.getInstance(),this.backboneModel=new r.Models.BookingLeftDto,this.bookingLeftViewModel=new n.BookingLeftViewModel(this.backboneModel,this),this.bookingLeftView=new n.BookingLeftView({viewModel:this.bookingLeftViewModel})}return __extends(e,o),e.prototype.Show=function(){var o=this,e=this.app.request("AppGlobalSetting"),t=new r.Models.BookingLeftDto;t.set("officerId",e.get("Id"));var i=p.GetByCriteria(t);i.done(function(e){return o.GetByCriteriaCompleted(e)})},e.prototype.GetByCriteriaCompleted=function(o){var e=this;this.backboneModel=new Backbone.Model(o.bookingLeftModel);var t=this.backboneModel;this.UIBinding(t),this.bookingLeftView=new n.BookingLeftView({viewModel:this.bookingLeftViewModel}),this.bookingLeftView.on("ShowTotalBooking",function(){return e.ShowTotalBooking()}),this.bookingLeftView.on("ShowPaidBooking",function(){return e.ShowPaidBooking()}),this.bookingLeftView.on("ShowUnpaidBooking",function(){return e.ShowUnpaidBooking()}),this.bookingLeftView.on("ShowTodayBooking",function(){return e.ShowTodayBooking()}),this.app.LeftRegion.show(this.bookingLeftView)},e.prototype.ShowTotalBooking=function(){(new l.BookingCtrl).GetAll(1)},e.prototype.ShowPaidBooking=function(){(new l.BookingCtrl).GetAll(2)},e.prototype.ShowUnpaidBooking=function(){(new l.BookingCtrl).GetAll(3)},e.prototype.ShowTodayBooking=function(){(new l.BookingCtrl).GetAll(4)},e.prototype.UIBinding=function(o){this.bookingLeftViewModel.bbModel=o,this.bookingLeftViewModel.model=d.viewModel(o),g.cleanNode($(this.bookingLeftView.el)[0]),g.applyBindings(this.bookingLeftViewModel,this.bookingLeftView.el)},e.prototype.ShowProgressbar=function(){var o=(this.app.ModalRegion.currentView,new Backbone.Model({type:"btn-",title:"title",message:"message"})),e=new n.ProgressbarView({model:o});void 0==this.app.ModalRegion.currentView&&this.app.ModalRegion.show(e)},e.prototype.HideProgressbar=function(){this.app.ModalRegion.currentView;this.app.ModalRegion.close(),$(".modal-backdrop").remove()},e.prototype.ShowModalPopup=function(o,e,t){var i=new Backbone.Model({type:"btn-"+o,title:e,message:t}),r=new n.ModalPopupView({model:i});this.app.ModalAlertRegion.show(r)},e.prototype.PrintReceipt=function(o){var e=this,t=a.GetById(o);t.done(function(o){return e.GetReceiptContentCompleted(o)})},e.prototype.GetReceiptContentCompleted=function(o){var e=this,t=s.map(o.receiptContentList,function(o){var t=new Date(o.printDateTime),n=e.app.request("AppGlobalSetting");return o.bookingDate=i.FormatDateString(o.bookingDate),o.printDateTime=i.FormatDateString(o.printDateTime)+"    "+t.getHours()+":"+t.getMinutes(),o.bookingAmount=i.FormatMoney(o.bookingAmount),o.userName=n.get("FirstName")+","+n.get("LastName"),o}),r=new Backbone.Collection(t),p=new n.ReceiptLayoutCollectionView({collection:r});this.app.ModalAlertRegion.show(p),this.app.ModalAlertRegion.show(p),p.on("Event-PrintPDFReceipt",function(){e.ExportToPdf(p.$el.find("#ReceiptLayout")[0]),e.app.ModalAlertRegion.close()})},e.prototype.ExportToPdf=function(o){var e=new w("p","pt","a4"),t=o,i={top:20,bottom:60,left:20,width:522};e.fromHTML(t,i.left,i.top,{width:i.width},function(){e.save("CCTRacking-Receipt.pdf")},i)},e}(i.Controller));e.BookingLeftCtrl=c});