var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n};define(["require","exports","../App","../Helper","./RefundBookingView","../Dtos/RefundBookingDto","../DAL/RefundBooking","marionette","jquery","knockout"],function(e,t,n,o,i,s,d){var r=e("underscore"),c=(e("knockout"),e("knockback")),a=function(e){function t(){e.call(this),this.app=n.Application.getInstance(),this.backboneModel=new s.Models.RefundBookingDto}return __extends(t,e),t.prototype.EditRefund=function(e){var t=this,n=d.GetById(e);n.done(function(e){return t.GetByIdCompleted(e)})},t.prototype.Load=function(){var e=this,t=JSON.parse(localStorage.getItem("lookupResponse")),n=this.backboneModel;this.viewModel.bbModel=n,this.viewModel.model=c.viewModel(n),n.set("name",""),n.set("address",""),n.set("landmarkIdSelected",""),n.set("landmarkList",t.landmark),n.set("contactNo1",""),n.set("contactNo2",""),n.set("isCoPartner",""),n.set("isActive",""),this.viewModel=new i.RefundBookingViewModel(n,this),this.view=new i.RefundBookingView({viewModel:this.viewModel}),this.view.on("Event:SaveForm",function(){return e.Save(e.view.model)}),this.view.on("Event:CancelForm",function(){return e.Cancel()}),this.app.MainRegion.show(this.view)},t.prototype.GetByIdCompleted=function(e){var t=this;this.collection=e.refundBookingList,this.backboneModel=new Backbone.Model(e.refundBookingList[0]);var n=this.backboneModel;this.UIBinding(n),this.view=new i.RefundBookingView({viewModel:this.viewModel}),this.view.on("Event:SaveForm",function(){return t.Save(t.viewModel.bbModel)}),this.view.on("Event:CancelForm",function(){return t.Cancel()}),this.app.MainRegion.show(this.view)},t.prototype.Save=function(e){var t=this,n=this.app.request("AppGlobalSetting");e.set("modifiedBy",n.get("Id")),void 0==e.get("refundTypeSelected")?e.set("refundTypeId",e.get("refundTypeId")):e.set("refundTypeId",e.get("refundTypeSelected").id),void 0==e.get("alkhidmatCentreSelected")?e.set("refundOfficeLocation",e.get("refundOfficeLocation")):e.set("refundOfficeLocation",e.get("alkhidmatCentreSelected").id),void 0==e.get("busSelected")?e.set("busId",e.get("busId")):e.set("busId",e.get("busSelected").id),void 0==e.get("cashierSelected")?e.set("refundOfficer",e.get("refundOfficer")):e.set("refundOfficer",e.get("cashierSelected").id),e.set("isActive","1"==e.get("isActive")?!0:!1),e.set("id",$("#hdnRefundId").val());var o=d.Save(e);o.done(function(e){return t.SaveCompleted(e)})},t.prototype.SaveCompleted=function(e){var t=new Backbone.Model(e);void 0!=t.get("errorMessage")&&""!=t.get("errorMessage").trim()?o.ShowModalPopup("danger","Booking","Due to some technical reason booking payment have not been saved successfully!<br> Pelase try later"):(o.ShowModalPopup("success","Booking","Record has been saved successfully with ID : "+e.id),this.Cancel())},t.prototype.Cancel=function(){window.location.href="#viewBooking"},t.prototype.UIBinding=function(e){var t=JSON.parse(localStorage.getItem("lookupResponse"));e.set("busList",e.get("busList")),e.set("busSelected",""),e.set("alkhidmatCentreList",t.alkhidmatCentre),e.set("cashierList",t.cashier),e.set("refundTypeList",t.refundType);var n=r.filter(t.alkhidmatCentre,function(t){return t.id==e.get("refundOfficeLocation")});e.set("alkhidmatCentreSelected",n[0]);var o=r.filter(t.cashier,function(t){return t.id==e.get("refundOfficer")});e.set("cashierSelected",o[0]);var s=r.filter(t.refundType,function(t){return t.id==e.get("refundTypeId")});e.set("refundTypeSelected",s[0]),s.length>0?e.set("refundTypeSelectedDesc",s[0].description):e.set("refundTypeSelectedDesc",""),n.length>0?e.set("refundFromOfficeDesc",n[0].description):e.set("refundFromOfficeDesc",""),o.length>0?e.set("refundCashierDesc",o[0].description):e.set("refundCashierDesc",""),e.set("refundBookings",this.collection),this.viewModel=new i.RefundBookingViewModel(e,this),this.viewModel.bbModel=e},t}(o.Controller);t.RefundBookingCtrl=a});