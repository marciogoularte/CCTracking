var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);n.prototype=t.prototype,e.prototype=new n};define(["require","exports","../App","../Helper","./SearchView","CCTracking.WebClient/Dtos/SearchDto","../DAL/Search","marionette","jquery","knockout","text!./SearchTmpl.html"],function(e,t,n,a,o,i,r){var s=e("underscore"),d=e("knockout"),c=e("knockback"),l=function(e){function t(){e.call(this),this.app=n.Application.getInstance(),this.searchFromLayout=new o.SearchFormLayoutView,this.searchModel=new i.Models.SearchDto,this.searchFormView=new o.SearchFormItemView,this.searchViewModel=new o.SearchViewModel(this.backboneModel,this)}return __extends(t,e),t.prototype.Show=function(){this.Load()},t.prototype.Load=function(){var e=this,t=JSON.parse(localStorage.getItem("lookupResponse")),n=this.searchModel;n.set("graveyardList",t.graveyard),n.set("graveyardIdSelected",""),n.set("alkhidmatCentreList",t.alkhidmatCentre),n.set("alkhidmatCentreSelected",""),n.set("busList",t.bus),n.set("busSelected",""),n.set("genderId",""),n.set("contactInfo",""),n.set("deseasedInfo",""),n.set("paymentStatusId",""),n.set("bookingDate",""),this.searchFormView.listenTo(this.searchFormView,"SearchBooking",function(){return e.GetByCriteria(n)}),this.searchFormView.on("CancelForm",function(){return e.Cancel()}),this.app.MainRegion.show(this.searchFromLayout),this.searchFromLayout.SearchRegion.show(this.searchFormView),this.KOBinding(n)},t.prototype.GetByCriteria=function(e){var t=this;e.set("genderId",e.get("genderId").toString()),e.set("paymentStatusId",e.get("paymentStatusId").toString()),""!=e.get("bookingDate").trim()&&e.set("bookingDate",a.FormatDateString(e.get("bookingDate"))),void 0!=e.get("graveyardIdSelected")&&e.set("greveyardId",e.get("graveyardIdSelected").id),void 0!=e.get("alkhidmatCentreSelected")&&e.set("centreId",e.get("alkhidmatCentreSelected").id),void 0!=e.get("busSelected")&&e.set("busId",e.get("busSelected").id);var n=r.GetByCriteria(this.GetMinimalRequest(e));n.done(function(e){return t.GetByCriteriaCompleted(e)})},t.prototype.GetMinimalRequest=function(e){var t=new i.Models.SearchDto;return t.set("bookingDate",e.get("bookingDate")),t.set("busId",e.get("busId")),t.set("centreId",e.get("centreId")),t.set("contactInfo",e.get("contactInfo")),t.set("deseasedInfo",e.get("deseasedInfo")),t.set("genderId",e.get("genderId")),t.set("greveyardId",e.get("greveyardId")),t.set("paymentStatusId",e.get("paymentStatusId")),t},t.prototype.GetByCriteriaCompleted=function(e){var t=s.map(e.bookingList,function(e){return e.pickupDate="0001-01-01T00:00:00"!=e.pickupDate?a.FormatDateString(e.pickupDate):"",e.status=e.status?"Paid":"Unpaid",e}),n=new Backbone.Collection(t),i=new o.SearchCollectionView({collection:n});this.searchFromLayout.ContentRegion.show(i)},t.prototype.KOBinding=function(e){var t=c.viewModel(e),n=this.searchFormView.$el,a=n.find("#ddlGraveyard")[0];d.cleanNode(a),d.applyBindings(t,a);var o=n.find("#ddlCentre")[0];d.cleanNode(o),d.applyBindings(t,o);var i=n.find("#ddlBusDetails")[0];d.cleanNode(i),d.applyBindings(t,i);var r=n.find("#txtContactInfo")[0];d.cleanNode(r),d.applyBindings(t,r);var s=n.find("#txtDeseasedInfo")[0];d.cleanNode(s),d.applyBindings(t,s);var l=n.find(".jsGender")[0];d.cleanNode(l),d.applyBindings(t,l),l=n.find(".jsGender")[1],d.cleanNode(l),d.applyBindings(t,l);var p=n.find(".jsPaymentStatus")[0];d.cleanNode(p),d.applyBindings(t,p),p=n.find(".jsPaymentStatus")[1],d.cleanNode(p),d.applyBindings(t,p);var g=n.find("#txtBookingDate")[0];d.cleanNode(g),d.applyBindings(t,g)},t.prototype.Cancel=function(){var e=this.searchModel;e.set("graveyardIdSelected",""),e.set("alkhidmatCentreSelected",""),e.set("busSelected",""),e.set("genderId",""),e.set("contactInfo",""),e.set("deseasedInfo",""),e.set("paymentStatusId",""),e.set("bookingDate","")},t}(a.Controller);t.SearchCtrl=l});