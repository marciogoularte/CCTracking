var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};define(["require","exports","backbone"],function(n,t){(function(n){var t=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.default=function(){return{id:"",firstName:"",lastName:"",email:"",mobile:"",nic:"",userName:"",password:"",resetPassword:"",isAdmin:!1,authenticationToken:"",errorMessage:""}},t}(Backbone.Model);n.LoginDto=t})(t.Models||(t.Models={}));var i=t.Models});__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};define(["require","exports","CCTracking.WebClient/DAL/AjaxRequest","CCTracking.WebClient/Dtos/LoginDto"],function(n,t,i,r){function f(n){var t=new u;return t.doAjaxRequest(n,"POST","Login")}function e(n){var t=new u;return t.doAjaxRequest(n,"POST","ChangePassword")}var u=function(n){function t(){n.call(this,this)}return __extends(t,n),t.prototype.getResponse=function(){return new r.Models.LoginDto},t}(i.BaseDto);t.LoginDal=u;t.Login=f;t.ChangePasswrd=e});__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};define(["require","exports","../Helper","../App","marionette","jquery","knockout","text!./Login.html"],function(n,t,i,r){var o=n("underscore"),f=n("text!./Login.html"),e=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t}(i.ViewModel),u;t.LoginViewModel=e;u=function(n){function t(t){this.template=f;this.events={submit:"Login"};this.App=r.Application.getInstance();n.call(this,t)}return __extends(t,n),t.prototype.Login=function(n){n.preventDefault();this.trigger("LoginUser")},t}(i.Views.MvvmView);t.LoginView=u});__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};define(["require","exports","../App","../Helper","./LoginView","../Dtos/LoginDto","../DAL/Login","../Common/Views/HeaderView","../Dtos/AppObjectDto","../Bus/BusAvailabilityCtrl","../Home/HomeCtrl","marionette","jquery","knockout","text!./Login.html"],function(n,t,i,r,u,f,e,o,s,h,c){var a=n("underscore"),v=n("knockout"),y=n("knockback"),l=function(t){function l(){t.call(this);this.app=i.Application.getInstance();this.backboneModel=new f.Models.LoginDto;this.loginViewModel=new u.LoginViewModel(this.backboneModel,this);this.loginView=new u.LoginView({viewModel:this.loginViewModel})}return __extends(l,t),l.prototype.Load=function(){var n=this;this.loginView=new u.LoginView;this.app.LoginRegion.show(this.loginView);this.loginView.on("LoginUser",function(){return n.Login(n.loginViewModel.bbModel)})},l.prototype.Login=function(n){var i=this,r=this.app.request("AppGlobalSetting"),t;n.set("userName",$("#txtUserName").val());n.set("password",$("#txtPassword").val());t=e.Login(n);t.done(function(n){return i.Authenticated(n)})},l.prototype.Authenticated=function(t){var a=$("#lblLoginMessage"),i,f;if(t==undefined){r.ShowModalPopup("danger","Authentication","User name or password is wrong..!<br> Pelase try again");return}if(t.errorMessage!==null)r.ShowModalPopup("danger","Authentication",t.errorMessage);else{i=new s.Models.AppObject;i.set("Id",t.id);i.set("FirstName",t.firstName);i.set("LastName",t.lastName);i.set("UserName",t.userName);i.set("IsAdmin",t.isAdmin);i.set("AuthenticationToken",t.authenticationToken);this.app.reqres.setHandler("AppGlobalSetting",function(){return i},this);this.app.LoginRegion.close();var u=this.app.request("AppGlobalSetting"),e=new Backbone.Model({firstName:u.get("FirstName"),lastName:u.get("LastName"),userName:u.get("UserName")}),l=new o.HeaderItemView({model:e});this.app.HeaderRegion.show(l);(new h.BusAvailabilityCtrl).Show();u.get("IsAdmin")?(f=new c.HomeCtrl,f.Show(),this.app.applyRouting(this.app,this.app.AppLayout)):(n(["../Booking/BookingCtrl"],function(n){(new n.BookingCtrl).GetAll(1)}),this.app.applyRoutingForOperator(this.app,this.app.AppLayout))}},l.prototype.Cancel=function(){window.location.href="#viewLogin"},l}(r.Controller);t.LoginCtrl=l});